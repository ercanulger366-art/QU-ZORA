<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quizora ‚Äî Yarƒ±≈üma Platformu</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700;900&family=Exo+2:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #05050f;
  --bg2: #0a0a1a;
  --bg3: #0f0f24;
  --blue: #00c3ff;
  --blue2: #0080ff;
  --purple: #9b59ff;
  --purple2: #6c35d4;
  --gold: #ffd700;
  --gold2: #ffaa00;
  --green: #00ff88;
  --red: #ff3355;
  --text: #ffffff;
  --text2: #a0aec0;
  --text3: #4a5568;
  --glass: rgba(255,255,255,0.04);
  --glass2: rgba(255,255,255,0.08);
  --border: rgba(255,255,255,0.08);
  --border2: rgba(0,195,255,0.2);
  --shadow-blue: 0 0 30px rgba(0,195,255,0.3);
  --shadow-purple: 0 0 30px rgba(155,89,255,0.3);
  --shadow-gold: 0 0 30px rgba(255,215,0,0.4);
}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
html{scroll-behavior:smooth;}
body{background:var(--bg);color:var(--text);font-family:'Exo 2',sans-serif;min-height:100vh;overflow-x:hidden;line-height:1.6;}
.bg-layer{position:fixed;inset:0;z-index:0;pointer-events:none;background:radial-gradient(ellipse 80% 50% at 50% -20%,rgba(0,195,255,0.06) 0%,transparent 70%),radial-gradient(ellipse 60% 40% at 80% 100%,rgba(155,89,255,0.05) 0%,transparent 60%);}
.bg-grid{position:fixed;inset:0;z-index:0;pointer-events:none;background-image:linear-gradient(rgba(0,195,255,0.025) 1px,transparent 1px),linear-gradient(90deg,rgba(0,195,255,0.025) 1px,transparent 1px);background-size:60px 60px;}
.bg-stars{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden;}
.star{position:absolute;border-radius:50%;background:white;animation:twinkle var(--d) ease-in-out infinite;opacity:0;}
@keyframes twinkle{0%,100%{opacity:0;transform:scale(0.5);}50%{opacity:var(--op);transform:scale(1);}}
.hidden{display:none!important;}
.screen{position:relative;z-index:1;}
::-webkit-scrollbar{width:4px;}
::-webkit-scrollbar-thumb{background:var(--purple2);border-radius:4px;}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NAME EFFECTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.ne-gradient{background:linear-gradient(90deg,#ff6b6b,#ffd700,#00ff88,#00c3ff,#9b59ff);-webkit-background-clip:text;background-clip:text;color:transparent;background-size:300% 100%;animation:gradientShift 3s linear infinite;}
@keyframes gradientShift{0%{background-position:0% 50%;}100%{background-position:300% 50%;}}
.ne-neon{color:#00ff88;text-shadow:0 0 7px #00ff88,0 0 14px #00ff88,0 0 21px #00ff88;}
.ne-blink{animation:nameBlink 1s step-end infinite;}
@keyframes nameBlink{0%,100%{opacity:1;}50%{opacity:0.2;}}
.ne-fire{background:linear-gradient(180deg,#fff700,#ff8c00,#ff3300,#cc0000);-webkit-background-clip:text;background-clip:text;color:transparent;animation:fireFlicker 0.5s ease-in-out infinite alternate;}
@keyframes fireFlicker{0%{filter:brightness(1);}100%{filter:brightness(1.3);}}
.ne-shine{position:relative;color:var(--gold);overflow:hidden;}
.ne-shine::after{content:'';position:absolute;top:0;left:-100%;width:60%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.6),transparent);animation:nameShine 2s infinite;}
@keyframes nameShine{0%{left:-100%;}100%{left:200%;}}
.ne-rainbow{background:linear-gradient(90deg,#ff0000,#ff7700,#ffff00,#00ff00,#0000ff,#8b00ff);-webkit-background-clip:text;background-clip:text;color:transparent;background-size:600% 100%;animation:rainbowShift 2s linear infinite;}
@keyframes rainbowShift{0%{background-position:0%;}100%{background-position:600%;}}
.ne-ice{color:#a0f0ff;text-shadow:0 0 10px #00c3ff,0 0 20px #00c3ff,0 0 40px rgba(0,195,255,0.5);}
.ne-gold{background:linear-gradient(135deg,#ffd700,#ffaa00,#ff8c00,#ffd700);-webkit-background-clip:text;background-clip:text;color:transparent;background-size:200% 100%;animation:goldShimmer 2s ease-in-out infinite;}
@keyframes goldShimmer{0%{background-position:0%;}100%{background-position:200%;}}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PROFILE FRAMES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.frame-wrap{position:relative;display:inline-flex;align-items:center;justify-content:center;}
.pf-gold .frame-wrap::before,.frame-gold::before{content:'';position:absolute;inset:-3px;border-radius:50%;background:conic-gradient(#ffd700,#ffaa00,#ff8c00,#ffd700,#ffaa00,#ffd700);animation:spinFrame 3s linear infinite;z-index:-1;}
.pf-neon .frame-wrap::before,.frame-neon::before{content:'';position:absolute;inset:-3px;border-radius:50%;background:conic-gradient(#00ff88,#00c3ff,#9b59ff,#00ff88);animation:spinFrame 2s linear infinite;z-index:-1;filter:blur(2px);}
.pf-fire .frame-wrap::before,.frame-fire::before{content:'';position:absolute;inset:-4px;border-radius:50%;background:conic-gradient(#ff0000,#ff8c00,#ffff00,#ff8c00,#ff0000);animation:spinFrame 1.5s linear infinite;z-index:-1;filter:blur(1px);}
.pf-spin .frame-wrap::before,.frame-spin::before{content:'';position:absolute;inset:-3px;border-radius:50%;border:3px solid transparent;border-top-color:#00c3ff;border-right-color:#9b59ff;border-bottom-color:#ffd700;animation:spinFrame 1s linear infinite;z-index:-1;}
.pf-diamond .frame-wrap::before,.frame-diamond::before{content:'';position:absolute;inset:-4px;border-radius:50%;background:conic-gradient(#a8edea,#fed6e3,#a8edea,#d4fc79,#a8edea);animation:spinFrame 4s linear infinite;z-index:-1;}
@keyframes spinFrame{from{transform:rotate(0deg);}to{transform:rotate(360deg);}}

/* Avatar with frame */
.avatar-container{position:relative;display:inline-flex;align-items:center;justify-content:center;width:40px;height:40px;}
.avatar-container.has-frame::before{content:'';position:absolute;inset:-4px;border-radius:50%;z-index:0;}
.avatar-container.frame-gold::before{background:conic-gradient(#ffd700,#ffaa00,#ff8c00,#ffd700);animation:spinFrame 3s linear infinite;}
.avatar-container.frame-neon::before{background:conic-gradient(#00ff88,#00c3ff,#9b59ff,#00ff88);animation:spinFrame 2s linear infinite;filter:blur(1px);}
.avatar-container.frame-fire::before{background:conic-gradient(#ff0000,#ff8c00,#ffff00,#ff8c00,#ff0000);animation:spinFrame 1.5s linear infinite;}
.avatar-container.frame-spin::before{border:3px solid transparent;border-top-color:#00c3ff;border-right-color:#9b59ff;border-bottom-color:#ffd700;animation:spinFrame 1s linear infinite;background:transparent;}
.avatar-container.frame-diamond::before{background:conic-gradient(#a8edea,#fed6e3,#a8edea,#d4fc79,#a8edea);animation:spinFrame 4s linear infinite;}
.avatar-inner{position:relative;z-index:1;width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,var(--blue2),var(--purple2));display:flex;align-items:center;justify-content:center;font-family:'Cinzel',serif;font-weight:700;font-size:1rem;overflow:hidden;}
.avatar-inner img{width:100%;height:100%;object-fit:cover;border-radius:50%;}

/* Big avatar (profile modal) */
.avatar-big-container{position:relative;display:inline-flex;align-items:center;justify-content:center;margin:0 auto 16px;}
.avatar-big-container.has-frame::before{content:'';position:absolute;inset:-6px;border-radius:50%;z-index:0;}
.avatar-big-container.frame-gold::before{background:conic-gradient(#ffd700,#ffaa00,#ff8c00,#ffd700);animation:spinFrame 3s linear infinite;}
.avatar-big-container.frame-neon::before{background:conic-gradient(#00ff88,#00c3ff,#9b59ff,#00ff88);animation:spinFrame 2s linear infinite;filter:blur(2px);}
.avatar-big-container.frame-fire::before{background:conic-gradient(#ff0000,#ff8c00,#ffff00,#ff8c00,#ff0000);animation:spinFrame 1.5s linear infinite;}
.avatar-big-container.frame-spin::before{border:4px solid transparent;border-top-color:#00c3ff;border-right-color:#9b59ff;border-bottom-color:#ffd700;animation:spinFrame 1s linear infinite;background:transparent;}
.avatar-big-container.frame-diamond::before{background:conic-gradient(#a8edea,#fed6e3,#a8edea,#d4fc79,#a8edea);animation:spinFrame 4s linear infinite;}
.avatar-big-inner{position:relative;z-index:1;width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,var(--blue2),var(--purple2));display:flex;align-items:center;justify-content:center;font-family:'Cinzel',serif;font-weight:700;font-size:2rem;border:3px solid rgba(255,255,255,0.1);overflow:hidden;cursor:pointer;}
.avatar-big-inner img{width:100%;height:100%;object-fit:cover;border-radius:50%;}
.avatar-upload-hint{position:absolute;bottom:0;right:0;z-index:2;background:var(--blue2);border:2px solid var(--bg);border-radius:50%;width:24px;height:24px;display:flex;align-items:center;justify-content:center;font-size:0.7rem;cursor:pointer;}

/* AUTH */
#auth-screen{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;}
.auth-box{width:100%;max-width:420px;animation:slideUp 0.6s cubic-bezier(0.22,1,0.36,1) forwards;}
@keyframes slideUp{from{opacity:0;transform:translateY(30px);}to{opacity:1;transform:translateY(0);}}
.logo-wrap{text-align:center;margin-bottom:32px;}
.logo-svg{width:200px;height:60px;margin:0 auto 8px;}
.logo-tagline{font-size:0.75rem;color:var(--text2);letter-spacing:6px;text-transform:uppercase;}
.auth-card{background:var(--glass);border:1px solid var(--border);border-radius:24px;padding:36px;backdrop-filter:blur(24px);box-shadow:0 40px 80px rgba(0,0,0,0.6),inset 0 1px 0 rgba(255,255,255,0.05);}
.auth-tabs{display:flex;gap:4px;background:rgba(0,0,0,0.4);padding:4px;border-radius:14px;margin-bottom:28px;}
.auth-tab{flex:1;padding:11px;border:none;background:transparent;color:var(--text2);font-family:'Exo 2',sans-serif;font-size:0.9rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;cursor:pointer;border-radius:11px;transition:all 0.3s;}
.auth-tab.active{background:linear-gradient(135deg,var(--blue2),var(--purple2));color:white;box-shadow:var(--shadow-blue);}
.form-group{margin-bottom:16px;}
.form-label{display:block;font-size:0.72rem;letter-spacing:2px;text-transform:uppercase;color:var(--text2);margin-bottom:7px;font-weight:600;}
.form-input{width:100%;padding:13px 16px;background:rgba(0,0,0,0.4);border:1px solid var(--border);border-radius:12px;color:var(--text);font-family:'Exo 2',sans-serif;font-size:1rem;font-weight:500;outline:none;transition:all 0.3s;}
.form-input:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(0,195,255,0.1);}
.form-input::placeholder{color:var(--text3);}
.remember-row{display:flex;align-items:center;gap:10px;margin-bottom:20px;cursor:pointer;}
.remember-row input{width:16px;height:16px;cursor:pointer;accent-color:var(--blue);}
.remember-row span{font-size:0.85rem;color:var(--text2);}
.btn-auth{width:100%;padding:14px;background:linear-gradient(135deg,var(--blue2),var(--purple2));border:none;border-radius:14px;color:white;font-family:'Cinzel',serif;font-size:1rem;font-weight:700;letter-spacing:2px;cursor:pointer;transition:all 0.3s;box-shadow:var(--shadow-blue);position:relative;overflow:hidden;}
.btn-auth::after{content:'';position:absolute;top:-50%;left:-60%;width:40%;height:200%;background:rgba(255,255,255,0.15);transform:skewX(-20deg);animation:btnShine 3s infinite;}
@keyframes btnShine{0%{left:-60%;}100%{left:160%;}}
.btn-auth:hover{transform:translateY(-2px);box-shadow:0 0 40px rgba(0,195,255,0.5);}
.auth-error{color:var(--red);font-size:0.82rem;text-align:center;margin-top:12px;min-height:18px;font-weight:600;}
.strength-bar{height:4px;border-radius:4px;background:rgba(255,255,255,0.1);margin-top:6px;overflow:hidden;}
.strength-fill{height:100%;border-radius:4px;transition:all 0.3s;width:0%;}

/* LOBBY */
#lobby-screen{min-height:100vh;padding:16px;}
.lobby-header{display:flex;align-items:center;justify-content:space-between;padding:12px 20px;background:var(--glass);border:1px solid var(--border);border-radius:16px;margin-bottom:20px;backdrop-filter:blur(20px);}
.lobby-logo-text{font-family:'Cinzel',serif;font-size:1.3rem;font-weight:900;letter-spacing:3px;background:linear-gradient(135deg,var(--blue),var(--purple));-webkit-background-clip:text;background-clip:text;color:transparent;}
.hdr-user{display:flex;align-items:center;gap:12px;}
.hdr-name{font-weight:700;font-size:0.95rem;}
.hdr-level{font-size:0.75rem;color:var(--blue);}
.hdr-wallet{display:flex;align-items:center;gap:6px;background:rgba(255,215,0,0.08);border:1px solid rgba(255,215,0,0.2);border-radius:20px;padding:5px 12px;font-weight:700;color:var(--gold);font-size:0.85rem;}
.hdr-xpboost{display:flex;align-items:center;gap:6px;background:rgba(0,255,136,0.08);border:1px solid rgba(0,255,136,0.3);border-radius:20px;padding:5px 12px;font-weight:700;color:var(--green);font-size:0.78rem;animation:boostPulse 2s ease-in-out infinite;}
@keyframes boostPulse{0%,100%{box-shadow:none;}50%{box-shadow:0 0 12px rgba(0,255,136,0.4);}}
.btn-logout{padding:7px 14px;background:transparent;border:1px solid rgba(255,51,85,0.3);border-radius:8px;color:var(--red);font-family:'Exo 2',sans-serif;font-size:0.78rem;font-weight:700;cursor:pointer;transition:all 0.3s;letter-spacing:1px;}
.btn-logout:hover{background:rgba(255,51,85,0.1);}
.lobby-grid{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:14px;margin-bottom:20px;}
@media(max-width:900px){.lobby-grid{grid-template-columns:1fr 1fr;}}
.stat-card{background:var(--glass);border:1px solid var(--border);border-radius:16px;padding:18px;text-align:center;backdrop-filter:blur(20px);transition:all 0.3s;}
.stat-card:hover{border-color:var(--border2);transform:translateY(-2px);}
.stat-icon{font-size:1.8rem;margin-bottom:8px;}
.stat-val{font-family:'Cinzel',serif;font-size:1.6rem;font-weight:700;background:linear-gradient(135deg,var(--blue),var(--purple));-webkit-background-clip:text;background-clip:text;color:transparent;}
.stat-lbl{font-size:0.7rem;color:var(--text2);letter-spacing:2px;text-transform:uppercase;margin-top:4px;}
.xp-section{background:var(--glass);border:1px solid var(--border);border-radius:16px;padding:18px 22px;margin-bottom:20px;backdrop-filter:blur(20px);}
.xp-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
.xp-level{font-family:'Cinzel',serif;font-weight:700;color:var(--gold);font-size:1rem;}
.xp-text{font-size:0.8rem;color:var(--text2);}
.xp-bar-bg{height:8px;border-radius:8px;background:rgba(255,255,255,0.08);overflow:hidden;}
.xp-bar-fill{height:100%;border-radius:8px;background:linear-gradient(90deg,var(--blue2),var(--purple));transition:width 1s cubic-bezier(0.22,1,0.36,1);position:relative;overflow:hidden;}
.xp-bar-fill::after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);animation:xpShimmer 2s infinite;}
@keyframes xpShimmer{0%{transform:translateX(-100%);}100%{transform:translateX(100%);}}
.lobby-main{display:grid;grid-template-columns:2fr 1fr;gap:16px;}
@media(max-width:700px){.lobby-main{grid-template-columns:1fr;}}
.btn-play{padding:28px;background:linear-gradient(135deg,var(--blue2),var(--purple2));border:none;border-radius:18px;color:white;font-family:'Cinzel',serif;font-size:1.4rem;font-weight:900;letter-spacing:3px;cursor:pointer;transition:all 0.3s;box-shadow:0 0 40px rgba(0,128,255,0.4);position:relative;overflow:hidden;width:100%;}
.btn-play::before{content:'';position:absolute;inset:0;background:linear-gradient(45deg,transparent,rgba(255,255,255,0.1),transparent);animation:playShine 2.5s infinite;}
@keyframes playShine{0%{transform:translateX(-100%);}100%{transform:translateX(100%);}}
.btn-play:hover{transform:translateY(-3px);box-shadow:0 0 60px rgba(0,128,255,0.6);}
.btn-play-sub{font-size:0.75rem;letter-spacing:4px;opacity:0.7;margin-top:4px;font-family:'Exo 2',sans-serif;font-weight:400;}
.side-buttons{display:flex;flex-direction:column;gap:10px;}
.btn-side{padding:16px;background:var(--glass);border:1px solid var(--border);border-radius:14px;color:var(--text);font-family:'Exo 2',sans-serif;font-size:0.9rem;font-weight:700;cursor:pointer;transition:all 0.3s;letter-spacing:1px;text-align:center;}
.btn-side.gold{color:var(--gold);border-color:rgba(255,215,0,0.2);}
.btn-side.gold:hover{border-color:var(--gold);box-shadow:var(--shadow-gold);}
.btn-side.purple{color:var(--purple);border-color:rgba(155,89,255,0.2);}
.btn-side.purple:hover{border-color:var(--purple);box-shadow:var(--shadow-purple);}
.btn-side.blue{color:var(--blue);border-color:rgba(0,195,255,0.2);}
.btn-side.blue:hover{border-color:var(--blue);box-shadow:var(--shadow-blue);}

/* GAME */
#game-screen{min-height:100vh;display:flex;flex-direction:column;padding:12px;gap:10px;background:radial-gradient(ellipse at 50% 0%,rgba(0,80,160,0.15) 0%,transparent 60%);}
.game-top{display:flex;align-items:center;justify-content:space-between;gap:12px;}
.money-ladder{background:var(--glass);border:1px solid var(--border);border-radius:14px;padding:10px 16px;backdrop-filter:blur(20px);font-family:'Cinzel',serif;font-size:1rem;font-weight:700;color:var(--gold);display:flex;align-items:center;gap:8px;}
.game-score-panel{display:flex;gap:16px;align-items:center;background:var(--glass);border:1px solid var(--border);border-radius:14px;padding:10px 18px;backdrop-filter:blur(20px);}
.gscore-item{text-align:center;}
.gscore-lbl{font-size:0.6rem;color:var(--text2);letter-spacing:2px;text-transform:uppercase;}
.gscore-val{font-family:'Cinzel',serif;font-size:1.1rem;font-weight:700;color:var(--blue);}
.btn-exit{padding:8px 16px;background:transparent;border:1px solid rgba(255,51,85,0.3);border-radius:10px;color:var(--red);font-family:'Exo 2',sans-serif;font-size:0.78rem;font-weight:700;cursor:pointer;transition:all 0.3s;white-space:nowrap;}
.btn-exit:hover{background:rgba(255,51,85,0.1);}
.barriers{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;}
.barrier-item{padding:4px 12px;border-radius:20px;font-size:0.7rem;font-weight:700;letter-spacing:1px;}
.barrier-item.passed{background:rgba(0,255,136,0.15);border:1px solid rgba(0,255,136,0.3);color:var(--green);}
.barrier-item.current{background:rgba(255,215,0,0.2);border:1px solid var(--gold);color:var(--gold);animation:glow-gold 1.5s infinite;}
.barrier-item.future{background:rgba(255,255,255,0.03);border:1px solid var(--border);color:var(--text3);}
@keyframes glow-gold{0%,100%{box-shadow:none;}50%{box-shadow:0 0 15px rgba(255,215,0,0.5);}}
.timer-wrap{display:flex;align-items:center;justify-content:center;gap:12px;}
.timer-circle{width:64px;height:64px;border-radius:50%;background:conic-gradient(var(--blue) var(--pct,100%),rgba(255,255,255,0.05) 0%);display:flex;align-items:center;justify-content:center;font-family:'Cinzel',serif;font-size:1.1rem;font-weight:700;position:relative;box-shadow:0 0 20px rgba(0,195,255,0.3);transition:background 0.1s;}
.timer-circle.danger{background:conic-gradient(var(--red) var(--pct,100%),rgba(255,255,255,0.05) 0%);box-shadow:0 0 20px rgba(255,51,85,0.5);animation:timerPulse 0.5s infinite;}
@keyframes timerPulse{0%,100%{transform:scale(1);}50%{transform:scale(1.05);}}
.timer-lbl{font-size:0.65rem;color:var(--text2);letter-spacing:2px;text-transform:uppercase;text-align:center;}
.question-area{background:var(--glass);border:1px solid var(--border2);border-radius:20px;padding:28px 32px;backdrop-filter:blur(24px);box-shadow:0 0 40px rgba(0,195,255,0.05),inset 0 1px 0 rgba(255,255,255,0.05);position:relative;overflow:hidden;}
.question-area::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--blue),var(--purple),transparent);animation:scanLine 3s linear infinite;}
@keyframes scanLine{0%{opacity:0.5;}50%{opacity:1;}100%{opacity:0.5;}}
.q-meta{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;}
.q-number{font-size:0.75rem;color:var(--blue);font-weight:700;letter-spacing:3px;text-transform:uppercase;}
.q-diff{padding:3px 10px;border-radius:20px;font-size:0.7rem;font-weight:700;letter-spacing:1px;}
.q-diff.easy{background:rgba(0,255,136,0.1);color:var(--green);border:1px solid rgba(0,255,136,0.2);}
.q-diff.medium{background:rgba(255,170,0,0.1);color:var(--gold2);border:1px solid rgba(255,170,0,0.2);}
.q-diff.hard{background:rgba(255,51,85,0.1);color:var(--red);border:1px solid rgba(255,51,85,0.2);}
.q-text{font-size:1.15rem;font-weight:600;color:#ffffff;line-height:1.7;text-align:center;text-shadow:0 0 20px rgba(255,255,255,0.1);}
.answers-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px;}
@media(max-width:600px){.answers-grid{grid-template-columns:1fr;}}
.answer-btn{padding:16px 20px;background:rgba(0,0,0,0.4);border:2px solid rgba(255,255,255,0.08);border-radius:14px;color:#ffffff;font-family:'Exo 2',sans-serif;font-size:0.95rem;font-weight:600;cursor:pointer;transition:all 0.25s;text-align:left;display:flex;align-items:center;gap:12px;position:relative;overflow:hidden;}
.answer-btn:not(:disabled):hover{border-color:var(--blue);background:rgba(0,195,255,0.08);transform:translateX(4px);box-shadow:0 0 20px rgba(0,195,255,0.15);}
.answer-btn:disabled{cursor:not-allowed;}
.answer-letter{min-width:32px;height:32px;border-radius:50%;background:rgba(255,255,255,0.08);display:flex;align-items:center;justify-content:center;font-family:'Cinzel',serif;font-weight:700;font-size:0.85rem;flex-shrink:0;transition:all 0.25s;}
.answer-btn.correct{border-color:var(--green)!important;background:rgba(0,255,136,0.1)!important;animation:correctFlash 0.5s ease;}
.answer-btn.correct .answer-letter{background:var(--green);color:#000;}
.answer-btn.wrong{border-color:var(--red)!important;background:rgba(255,51,85,0.1)!important;animation:wrongShake 0.5s ease;}
.answer-btn.wrong .answer-letter{background:var(--red);color:white;}
.answer-btn.hidden-joker{opacity:0.2;pointer-events:none;}
/* Double answer joker selected state */
.answer-btn.double-selected{border-color:var(--gold)!important;background:rgba(255,215,0,0.08)!important;}
.answer-btn.double-selected .answer-letter{background:var(--gold);color:#000;}
@keyframes correctFlash{0%{box-shadow:none;}50%{box-shadow:0 0 40px rgba(0,255,136,0.6);}100%{box-shadow:none;}}
@keyframes wrongShake{0%,100%{transform:translateX(0);}25%{transform:translateX(-8px);}75%{transform:translateX(8px);}}
.jokers-bar{display:flex;gap:10px;justify-content:center;align-items:center;flex-wrap:wrap;}
.joker-btn{padding:10px 18px;background:rgba(155,89,255,0.1);border:1px solid rgba(155,89,255,0.3);border-radius:12px;color:var(--purple);font-family:'Exo 2',sans-serif;font-size:0.82rem;font-weight:700;cursor:pointer;transition:all 0.3s;letter-spacing:1px;display:flex;align-items:center;gap:6px;}
.joker-btn:hover:not(:disabled){background:rgba(155,89,255,0.2);box-shadow:0 0 20px rgba(155,89,255,0.3);transform:translateY(-2px);}
.joker-btn:disabled{opacity:0.3;cursor:not-allowed;transform:none;}
.joker-btn.used{opacity:0.2;cursor:not-allowed;text-decoration:line-through;}
.audience-chart{display:flex;gap:10px;align-items:flex-end;justify-content:center;padding:16px;background:rgba(0,0,0,0.3);border-radius:12px;margin-top:10px;}
.aud-bar-wrap{text-align:center;flex:1;}
.aud-bar-bg{height:80px;background:rgba(255,255,255,0.05);border-radius:6px;display:flex;align-items:flex-end;overflow:hidden;}
.aud-bar-fill{width:100%;border-radius:6px;background:linear-gradient(180deg,var(--blue),var(--purple2));transition:height 0.8s cubic-bezier(0.22,1,0.36,1);}
.aud-label{font-size:0.75rem;font-weight:700;color:var(--text2);margin-top:5px;}
.aud-pct{font-size:0.85rem;font-weight:700;color:var(--blue);}
.phone-msg{background:rgba(0,0,0,0.4);border:1px solid var(--border2);border-radius:12px;padding:16px;margin-top:10px;font-style:italic;color:var(--text);line-height:1.6;font-size:0.9rem;}
.game-status{text-align:center;font-size:0.9rem;color:var(--text2);font-weight:500;min-height:24px;letter-spacing:1px;}

/* LB */
.lb-row{display:flex;align-items:center;gap:12px;padding:12px 16px;border-radius:12px;margin-bottom:8px;background:var(--glass);border:1px solid var(--border);transition:all 0.3s;}
.lb-row.top1{background:rgba(255,215,0,0.06);border-color:rgba(255,215,0,0.25);}
.lb-row.top2{background:rgba(192,192,192,0.04);border-color:rgba(192,192,192,0.15);}
.lb-row.top3{background:rgba(205,127,50,0.05);border-color:rgba(205,127,50,0.15);}
.lb-row.me{border-color:rgba(0,195,255,0.4);box-shadow:0 0 15px rgba(0,195,255,0.1);}
.lb-rank{font-family:'Cinzel',serif;font-weight:700;min-width:36px;text-align:center;font-size:1rem;}
.lb-av-wrap{width:36px;height:36px;position:relative;flex-shrink:0;}
.lb-av-container{position:relative;display:inline-flex;align-items:center;justify-content:center;width:36px;height:36px;}
.lb-av-container.has-frame::before{content:'';position:absolute;inset:-3px;border-radius:50%;z-index:0;}
.lb-av-container.frame-gold::before{background:conic-gradient(#ffd700,#ffaa00,#ff8c00,#ffd700);animation:spinFrame 3s linear infinite;}
.lb-av-container.frame-neon::before{background:conic-gradient(#00ff88,#00c3ff,#9b59ff,#00ff88);animation:spinFrame 2s linear infinite;filter:blur(1px);}
.lb-av-container.frame-fire::before{background:conic-gradient(#ff0000,#ff8c00,#ffff00,#ff8c00,#ff0000);animation:spinFrame 1.5s linear infinite;}
.lb-av-container.frame-spin::before{border:2px solid transparent;border-top-color:#00c3ff;border-right-color:#9b59ff;border-bottom-color:#ffd700;animation:spinFrame 1s linear infinite;background:transparent;}
.lb-av-container.frame-diamond::before{background:conic-gradient(#a8edea,#fed6e3,#a8edea,#d4fc79,#a8edea);animation:spinFrame 4s linear infinite;}
.lb-av-inner{position:relative;z-index:1;width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--blue2),var(--purple2));display:flex;align-items:center;justify-content:center;font-family:'Cinzel',serif;font-weight:700;font-size:0.85rem;overflow:hidden;}
.lb-av-inner img{width:100%;height:100%;object-fit:cover;border-radius:50%;}
.lb-name{flex:1;font-weight:700;font-size:0.9rem;}
.lb-xp{font-family:'Cinzel',serif;color:var(--blue);font-weight:700;}
.lb-wr{font-size:0.72rem;color:var(--text2);}

/* MODALS */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.85);backdrop-filter:blur(12px);z-index:1000;display:flex;align-items:center;justify-content:center;padding:16px;}
.modal{background:var(--bg2);border:1px solid var(--border);border-radius:24px;padding:32px;max-width:480px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:0 40px 80px rgba(0,0,0,0.7);animation:modalPop 0.4s cubic-bezier(0.22,1,0.36,1);}
.modal::-webkit-scrollbar{width:3px;}
@keyframes modalPop{from{opacity:0;transform:scale(0.88) translateY(16px);}to{opacity:1;transform:scale(1) translateY(0);}}
.modal-title{font-family:'Cinzel',serif;font-size:1.5rem;font-weight:900;text-align:center;margin-bottom:6px;letter-spacing:2px;}
.modal-sub{color:var(--text2);text-align:center;font-size:0.82rem;letter-spacing:2px;text-transform:uppercase;margin-bottom:24px;}
.modal.win .modal-title{color:var(--gold);}
.modal.win{border-color:rgba(255,215,0,0.3);box-shadow:0 0 60px rgba(255,215,0,0.15);}
.modal.lose .modal-title{color:var(--red);}
.modal.lose{border-color:rgba(255,51,85,0.2);}
.modal-scores{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px;}
.modal-sc{background:var(--glass);border:1px solid var(--border);border-radius:14px;padding:16px;text-align:center;}
.modal-sc-lbl{font-size:0.72rem;color:var(--text2);letter-spacing:2px;text-transform:uppercase;margin-bottom:5px;}
.modal-sc-val{font-family:'Cinzel',serif;font-size:1.8rem;font-weight:700;color:var(--blue);}
.modal-reward{background:rgba(255,215,0,0.07);border:1px solid rgba(255,215,0,0.2);border-radius:12px;padding:14px;text-align:center;color:var(--gold);font-weight:600;font-size:0.9rem;margin-bottom:20px;line-height:1.6;}
.modal-btns{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.btn-modal-primary{padding:13px;background:linear-gradient(135deg,var(--blue2),var(--purple2));border:none;border-radius:12px;color:white;font-family:'Cinzel',serif;font-size:0.85rem;font-weight:700;letter-spacing:1px;cursor:pointer;transition:all 0.3s;}
.btn-modal-primary:hover{transform:translateY(-2px);box-shadow:var(--shadow-blue);}
.btn-modal-secondary{padding:13px;background:var(--glass);border:1px solid var(--border);border-radius:12px;color:var(--text);font-family:'Exo 2',sans-serif;font-size:0.85rem;font-weight:700;cursor:pointer;transition:all 0.3s;}
.btn-modal-secondary:hover{border-color:rgba(255,255,255,0.2);}
.btn-modal-full{padding:13px;width:100%;background:var(--glass);border:1px solid var(--border);border-radius:12px;color:var(--text);font-family:'Exo 2',sans-serif;font-size:0.9rem;font-weight:700;cursor:pointer;transition:all 0.3s;margin-top:10px;}
.btn-modal-full:hover{border-color:rgba(255,255,255,0.2);}

/* SHOP */
.shop-tabs{display:flex;gap:4px;background:rgba(0,0,0,0.4);padding:4px;border-radius:12px;margin-bottom:20px;}
.shop-tab{flex:1;padding:8px;border:none;background:transparent;color:var(--text2);font-family:'Exo 2',sans-serif;font-size:0.78rem;font-weight:700;letter-spacing:1px;text-transform:uppercase;cursor:pointer;border-radius:9px;transition:all 0.3s;}
.shop-tab.active{background:linear-gradient(135deg,var(--blue2),var(--purple2));color:white;}
.shop-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
@media(max-width:400px){.shop-grid{grid-template-columns:1fr;}}
.shop-item{background:var(--glass);border:1px solid var(--border);border-radius:14px;padding:16px;text-align:center;transition:all 0.3s;cursor:pointer;}
.shop-item:hover{border-color:var(--border2);transform:translateY(-2px);}
.shop-item.owned{border-color:rgba(0,255,136,0.3);}
.shop-item.active-effect{border-color:var(--gold);box-shadow:0 0 15px rgba(255,215,0,0.3);}
.shop-icon{font-size:1.8rem;margin-bottom:8px;}
.shop-name{font-weight:700;font-size:0.85rem;margin-bottom:4px;}
.shop-desc{font-size:0.72rem;color:var(--text2);margin-bottom:10px;}
.shop-price{display:inline-flex;align-items:center;gap:4px;background:rgba(255,215,0,0.1);border:1px solid rgba(255,215,0,0.2);border-radius:20px;padding:4px 10px;color:var(--gold);font-weight:700;font-size:0.82rem;}
.shop-owned{color:var(--green);font-size:0.78rem;font-weight:700;letter-spacing:1px;}
.shop-active-badge{color:var(--gold);font-size:0.78rem;font-weight:700;letter-spacing:1px;border:1px solid rgba(255,215,0,0.3);border-radius:20px;padding:2px 8px;}
.shop-btn-row{display:flex;gap:6px;justify-content:center;flex-wrap:wrap;margin-top:6px;}
.shop-btn-activate{padding:4px 10px;background:rgba(255,215,0,0.1);border:1px solid rgba(255,215,0,0.3);border-radius:20px;color:var(--gold);font-size:0.75rem;font-weight:700;cursor:pointer;transition:all 0.2s;}
.shop-btn-activate:hover{background:rgba(255,215,0,0.2);}
.shop-btn-deactivate{padding:4px 10px;background:rgba(255,51,85,0.1);border:1px solid rgba(255,51,85,0.3);border-radius:20px;color:var(--red);font-size:0.75rem;font-weight:700;cursor:pointer;transition:all 0.2s;}

/* Frame preview */
.frame-preview{width:48px;height:48px;position:relative;display:inline-flex;align-items:center;justify-content:center;margin:0 auto 8px;}
.frame-preview.has-frame::before{content:'';position:absolute;inset:-4px;border-radius:50%;}
.frame-preview.frame-gold::before{background:conic-gradient(#ffd700,#ffaa00,#ff8c00,#ffd700);animation:spinFrame 3s linear infinite;}
.frame-preview.frame-neon::before{background:conic-gradient(#00ff88,#00c3ff,#9b59ff,#00ff88);animation:spinFrame 2s linear infinite;filter:blur(1px);}
.frame-preview.frame-fire::before{background:conic-gradient(#ff0000,#ff8c00,#ffff00,#ff8c00,#ff0000);animation:spinFrame 1.5s linear infinite;}
.frame-preview.frame-spin::before{border:3px solid transparent;border-top-color:#00c3ff;border-right-color:#9b59ff;border-bottom-color:#ffd700;animation:spinFrame 1s linear infinite;background:transparent;}
.frame-preview.frame-diamond::before{background:conic-gradient(#a8edea,#fed6e3,#a8edea,#d4fc79,#a8edea);animation:spinFrame 4s linear infinite;}
.frame-preview-inner{position:relative;z-index:1;width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg,var(--blue2),var(--purple2));display:flex;align-items:center;justify-content:center;font-size:1.4rem;}

/* Name effect preview */
.name-effect-preview{font-family:'Cinzel',serif;font-weight:700;font-size:1rem;margin-bottom:6px;display:inline-block;}

/* TOAST */
.toast-container{position:fixed;top:20px;right:20px;z-index:9999;display:flex;flex-direction:column;gap:8px;}
.toast{padding:12px 20px;border-radius:12px;font-weight:600;font-size:0.88rem;backdrop-filter:blur(20px);border:1px solid var(--border);animation:toastIn 0.4s cubic-bezier(0.22,1,0.36,1);max-width:300px;}
.toast.success{background:rgba(0,255,136,0.15);border-color:rgba(0,255,136,0.3);color:var(--green);}
.toast.error{background:rgba(255,51,85,0.15);border-color:rgba(255,51,85,0.3);color:var(--red);}
.toast.info{background:rgba(0,195,255,0.12);border-color:rgba(0,195,255,0.25);color:var(--blue);}
.toast.gold{background:rgba(255,215,0,0.12);border-color:rgba(255,215,0,0.25);color:var(--gold);}
@keyframes toastIn{from{opacity:0;transform:translateX(30px);}to{opacity:1;transform:translateX(0);}}

/* EFFECT OVERLAY */
.effect-overlay{position:fixed;inset:0;z-index:2000;display:flex;align-items:center;justify-content:center;pointer-events:none;}
.effect-text{font-family:'Cinzel',serif;font-weight:900;font-size:3.5rem;text-align:center;animation:effectPop 1.6s cubic-bezier(0.22,1,0.36,1) forwards;opacity:0;}
@keyframes effectPop{0%{opacity:0;transform:scale(0.5);}20%{opacity:1;transform:scale(1.2);}60%{opacity:1;transform:scale(1);}100%{opacity:0;transform:scale(0.9) translateY(-30px);}}
.effect-text.correct-color{background:linear-gradient(135deg,var(--green),var(--blue));-webkit-background-clip:text;background-clip:text;color:transparent;filter:drop-shadow(0 0 20px rgba(0,255,136,0.6));}
.effect-text.wrong-color{color:var(--red);filter:drop-shadow(0 0 20px rgba(255,51,85,0.6));}

/* PROFILE */
.profile-stat-row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:16px;}
.profile-stat{background:var(--glass);border:1px solid var(--border);border-radius:12px;padding:12px;text-align:center;}
.profile-stat-v{font-family:'Cinzel',serif;font-size:1.2rem;font-weight:700;color:var(--blue);}
.profile-stat-l{font-size:0.65rem;color:var(--text2);letter-spacing:1px;text-transform:uppercase;}

/* ADMIN */
.admin-form{display:flex;flex-direction:column;gap:12px;}
.admin-form textarea{width:100%;padding:12px;background:rgba(0,0,0,0.4);border:1px solid var(--border);border-radius:10px;color:var(--text);font-family:'Exo 2',sans-serif;font-size:0.9rem;resize:vertical;min-height:80px;outline:none;}
.admin-form textarea:focus{border-color:var(--blue);}
.admin-form select{width:100%;padding:12px;background:rgba(0,0,0,0.4);border:1px solid var(--border);border-radius:10px;color:var(--text);font-family:'Exo 2',sans-serif;outline:none;}
.admin-q-list{margin-top:16px;max-height:200px;overflow-y:auto;}
.admin-q-item{display:flex;justify-content:space-between;align-items:center;padding:10px;background:var(--glass);border-radius:10px;margin-bottom:6px;font-size:0.82rem;}
.btn-del{padding:4px 10px;background:rgba(255,51,85,0.1);border:1px solid rgba(255,51,85,0.3);border-radius:6px;color:var(--red);cursor:pointer;font-size:0.75rem;transition:all 0.2s;}
.btn-del:hover{background:rgba(255,51,85,0.2);}

/* VOICE */
.voice-card{padding:12px 14px;border-radius:12px;background:var(--glass);border:1px solid var(--border);margin-bottom:8px;cursor:pointer;transition:all 0.2s;}
.voice-card:hover{border-color:var(--border2);background:rgba(0,195,255,0.05);}
.voice-card.selected{border-color:rgba(0,195,255,0.4);background:rgba(0,195,255,0.06);}

/* LOADING */
.loading-screen{position:fixed;inset:0;z-index:5000;background:var(--bg);display:flex;align-items:center;justify-content:center;flex-direction:column;gap:20px;}
.loading-logo{font-family:'Cinzel',serif;font-size:3rem;font-weight:900;background:linear-gradient(135deg,var(--blue),var(--purple));-webkit-background-clip:text;background-clip:text;color:transparent;letter-spacing:4px;animation:loadingPulse 1.5s ease-in-out infinite;}
@keyframes loadingPulse{0%,100%{filter:brightness(0.8);}50%{filter:brightness(1.2);}}
.loading-bar-bg{width:200px;height:3px;border-radius:3px;background:rgba(255,255,255,0.08);overflow:hidden;}
.loading-bar-fill{height:100%;border-radius:3px;background:linear-gradient(90deg,var(--blue),var(--purple));animation:loadBar 1.8s ease-in-out infinite;}
@keyframes loadBar{0%{width:0%;margin-left:0;}50%{width:60%;margin-left:20%;}100%{width:0%;margin-left:100%;}}
.loading-status{font-size:0.8rem;color:var(--text2);letter-spacing:3px;}
.section-title{font-family:'Cinzel',serif;font-size:0.85rem;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--text2);margin-bottom:14px;padding-bottom:10px;border-bottom:1px solid var(--border);}
@media(max-width:480px){.game-top{flex-wrap:wrap;gap:8px;}.barriers{display:none;}.q-text{font-size:1rem;}.modal{padding:22px 16px;}.modal-title{font-size:1.2rem;}}

/* XP Boost indicator in game */
.xpboost-indicator{display:inline-flex;align-items:center;gap:4px;background:rgba(0,255,136,0.1);border:1px solid rgba(0,255,136,0.3);border-radius:20px;padding:3px 10px;color:var(--green);font-size:0.72rem;font-weight:700;animation:boostPulse 2s ease-in-out infinite;}
</style>
</head>
<body>

<div class="bg-layer"></div>
<div class="bg-grid"></div>
<div class="bg-stars" id="bg-stars"></div>
<div class="toast-container" id="toast-container"></div>
<div class="effect-overlay hidden" id="effect-overlay"><div class="effect-text" id="effect-text"></div></div>

<!-- LOADING -->
<div class="loading-screen" id="loading-screen">
  <div class="loading-logo">QUIZORA</div>
  <div class="loading-bar-bg"><div class="loading-bar-fill"></div></div>
  <div class="loading-status" id="loading-status">BAƒûLANIYOR...</div>
</div>

<!-- AUTH -->
<div id="auth-screen" class="screen hidden">
  <div class="auth-box">
    <div class="logo-wrap">
      <svg class="logo-svg" viewBox="0 0 200 60" fill="none" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="lg1" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#00c3ff"/><stop offset="100%" stop-color="#9b59ff"/></linearGradient>
          <filter id="glow"><feGaussianBlur stdDeviation="2" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
        </defs>
        <circle cx="28" cy="30" r="20" stroke="url(#lg1)" stroke-width="3" fill="none" filter="url(#glow)"/>
        <circle cx="28" cy="30" r="12" stroke="url(#lg1)" stroke-width="1.5" fill="none" opacity="0.4"/>
        <line x1="36" y1="42" x2="44" y2="52" stroke="url(#lg1)" stroke-width="3" stroke-linecap="round"/>
        <text x="56" y="38" font-family="Cinzel, serif" font-size="22" font-weight="900" fill="url(#lg1)" filter="url(#glow)">QUIZORA</text>
      </svg>
      <div class="logo-tagline">Bilgi Yarƒ±≈ümasƒ± Platformu</div>
    </div>
    <div class="auth-card">
      <div class="auth-tabs">
        <button class="auth-tab active" onclick="authTab('login')">Gƒ∞Rƒ∞≈û</button>
        <button class="auth-tab" onclick="authTab('register')">KAYIT</button>
      </div>
      <div id="login-form">
        <div class="form-group"><label class="form-label">Kullanƒ±cƒ± Adƒ±</label><input class="form-input" id="l-user" type="text" placeholder="kullanƒ±cƒ±_adƒ±nƒ±z" autocomplete="username"></div>
        <div class="form-group"><label class="form-label">≈ûifre</label><input class="form-input" id="l-pass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password"></div>
        <label class="remember-row"><input type="checkbox" id="l-remember" checked><span>Beni hatƒ±rla</span></label>
        <button class="btn-auth" onclick="doLogin()">Gƒ∞Rƒ∞≈û YAP</button>
      </div>
      <div id="register-form" class="hidden">
        <div class="form-group"><label class="form-label">Kullanƒ±cƒ± Adƒ±</label><input class="form-input" id="r-user" type="text" placeholder="en az 3 karakter" autocomplete="username"></div>
        <div class="form-group"><label class="form-label">≈ûifre</label><input class="form-input" id="r-pass" type="password" placeholder="en az 6 karakter" autocomplete="new-password" oninput="checkStrength(this.value)"><div class="strength-bar"><div class="strength-fill" id="strength-fill"></div></div></div>
        <div class="form-group"><label class="form-label">≈ûifre Tekrar</label><input class="form-input" id="r-pass2" type="password" placeholder="≈üifrenizi tekrar girin" autocomplete="new-password"></div>
        <button class="btn-auth" onclick="doRegister()">HESAP OLU≈ûTUR</button>
      </div>
      <div class="auth-error" id="auth-err"></div>
    </div>
  </div>
</div>

<!-- LOBBY -->
<div id="lobby-screen" class="screen hidden">
  <div class="lobby-header">
    <div class="lobby-logo-text">QUIZORA</div>
    <div class="hdr-user">
      <div id="hdr-xpboost" class="hdr-xpboost hidden">‚ö° 2x XP <span id="hdr-boost-timer"></span></div>
      <div class="hdr-wallet">üí∞ <span id="hdr-wallet">0</span></div>
      <!-- Avatar with frame -->
      <div class="avatar-container" id="hdr-avatar-container" onclick="openProfile()">
        <div class="avatar-inner" id="hdr-avatar">?</div>
      </div>
      <div><div class="hdr-name" id="hdr-name">‚Äî</div><div class="hdr-level" id="hdr-level">LVL 1</div></div>
    </div>
    <button class="btn-logout" onclick="doLogout()">√áIKI≈û</button>
  </div>
  <div class="lobby-grid">
    <div class="stat-card"><div class="stat-icon">üéÆ</div><div class="stat-val" id="s-games">0</div><div class="stat-lbl">Oyun</div></div>
    <div class="stat-card"><div class="stat-icon">üèÜ</div><div class="stat-val" id="s-wins">0</div><div class="stat-lbl">Galibiyet</div></div>
    <div class="stat-card"><div class="stat-icon">‚≠ê</div><div class="stat-val" id="s-xp">0</div><div class="stat-lbl">XP</div></div>
    <div class="stat-card"><div class="stat-icon">üí∞</div><div class="stat-val" id="s-money">0</div><div class="stat-lbl">Coin</div></div>
  </div>
  <div class="xp-section">
    <div class="xp-header"><div class="xp-level" id="xp-level-display">SEVƒ∞YE 1</div><div class="xp-text" id="xp-progress-text">0 / 500 XP</div></div>
    <div class="xp-bar-bg"><div class="xp-bar-fill" id="xp-bar" style="width:0%"></div></div>
  </div>
  <div class="lobby-main">
    <button class="btn-play" onclick="startGame()"><div>üéØ OYNA</div><div class="btn-play-sub">Kƒ∞M Mƒ∞LYONER OLMAK ƒ∞STER?</div></button>
    <div class="side-buttons">
      <button class="btn-side gold" onclick="openLeaderboard()">üèÖ SIRALAMALAR</button>
      <button class="btn-side purple" onclick="openShop()">üõí MAƒûAZA</button>
      <button class="btn-side blue" onclick="openVoiceSettings()">üéôÔ∏è SES AYARLARI</button>
      <button class="btn-side" id="admin-btn" style="color:var(--text2);display:none" onclick="openAdmin()">‚öôÔ∏è ADMƒ∞N</button>
    </div>
  </div>
</div>

<!-- GAME -->
<div id="game-screen" class="screen hidden">
  <div class="game-top">
    <div class="money-ladder">üí∞ <span id="g-prize">0</span></div>
    <div class="timer-wrap">
      <div>
        <div class="timer-circle" id="timer-circle" style="--pct:100%"><span id="timer-num">30</span></div>
        <div class="timer-lbl" id="timer-lbl">S√úRE</div>
      </div>
    </div>
    <div class="game-score-panel">
      <div class="gscore-item"><div class="gscore-lbl">SORU</div><div class="gscore-val" id="g-qnum">1/15</div></div>
      <div class="gscore-item"><div class="gscore-lbl">XP</div><div class="gscore-val" id="g-xp">+0</div></div>
    </div>
    <button class="btn-exit" onclick="exitGame()">‚úï √áIKI≈û</button>
  </div>
  <div class="barriers" id="barriers-bar"></div>
  <div class="question-area" id="question-area">
    <div class="q-meta"><div class="q-number" id="q-num-label">SORU 1</div><div class="q-diff" id="q-diff-badge">KOLAY</div></div>
    <div class="q-text" id="q-text">Soru y√ºkleniyor...</div>
    <div id="audience-result"></div>
    <div id="phone-result"></div>
  </div>
  <div class="answers-grid" id="answers-grid"></div>
  <div class="game-status" id="game-status">Oyun ba≈üladƒ±!</div>
  <div class="jokers-bar">
    <div style="font-size:0.72rem;color:var(--text2);letter-spacing:2px;">JOKERLER:</div>
    <button class="joker-btn" id="j-fifty" onclick="useJoker('fifty')">‚ö° %50</button>
    <button class="joker-btn" id="j-audience" onclick="useJoker('audience')">üë• SEYƒ∞RCƒ∞</button>
    <button class="joker-btn" id="j-phone" onclick="useJoker('phone')">üìû TELEFON</button>
    <button class="joker-btn" id="j-double" onclick="useJoker('double')" style="display:none;background:rgba(255,215,0,0.1);border-color:rgba(255,215,0,0.4);color:var(--gold);">‚úåÔ∏è √áƒ∞FT CEVAP</button>
    <button class="joker-btn" id="j-withdraw" onclick="withdrawGame()" style="background:rgba(255,215,0,0.1);border-color:rgba(255,215,0,0.4);color:var(--gold);">üí∞ √áEKƒ∞L</button>
  </div>
</div>

<!-- MODALS -->
<!-- Voice -->
<div class="modal-overlay hidden" id="modal-voice">
  <div class="modal" style="max-width:500px">
    <div class="modal-title" style="color:var(--blue)">üéôÔ∏è SES AYARLARI</div>
    <div class="modal-sub">Cihazƒ±nƒ±zdaki t√ºm sesler</div>
    <div id="voice-list" style="max-height:55vh;overflow-y:auto;padding-right:4px"></div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:16px">
      <button class="btn-modal-secondary" onclick="speechSynthesis.cancel();closeModal('modal-voice')">ƒ∞PTAL</button>
      <button class="btn-modal-primary" onclick="saveVoiceSettings()">KAYDET</button>
    </div>
  </div>
</div>

<!-- Game Over -->
<div class="modal-overlay hidden" id="modal-gameover">
  <div class="modal" id="modal-gameover-inner">
    <div style="font-size:3.5rem;text-align:center;margin-bottom:12px" id="go-icon">üèÜ</div>
    <div class="modal-title" id="go-title">TEBRƒ∞KLER!</div>
    <div class="modal-sub" id="go-sub">Harika performans!</div>
    <div class="modal-scores">
      <div class="modal-sc"><div class="modal-sc-lbl">SORULAR</div><div class="modal-sc-val" id="go-qright">0</div></div>
      <div class="modal-sc"><div class="modal-sc-lbl">KAZAN√á</div><div class="modal-sc-val" id="go-prize">0</div></div>
    </div>
    <div class="modal-reward" id="go-reward">+0 XP ¬∑ +0 Coin</div>
    <div class="modal-btns">
      <button class="btn-modal-primary" onclick="startGame()">TEKRAR OYNA</button>
      <button class="btn-modal-secondary" onclick="goLobby()">ANA MEN√ú</button>
    </div>
  </div>
</div>

<!-- Leaderboard -->
<div class="modal-overlay hidden" id="modal-lb">
  <div class="modal" style="max-width:520px">
    <div class="modal-title" style="color:var(--gold)">üèÖ SIRALAMALAR</div>
    <div class="modal-sub">XP Tablosu ‚Äî Canlƒ±</div>
    <div class="lb-list" id="lb-list"></div>
    <button class="btn-modal-full" onclick="closeModal('modal-lb');if(_lbUnsub){_lbUnsub();_lbUnsub=null;}">KAPAT</button>
  </div>
</div>

<!-- Shop -->
<div class="modal-overlay hidden" id="modal-shop">
  <div class="modal" style="max-width:560px">
    <div class="modal-title" style="color:var(--purple)">üõí MAƒûAZA</div>
    <div class="modal-sub">Bakiye: üí∞ <span id="shop-balance">0</span></div>
    <div class="shop-tabs">
      <button class="shop-tab active" id="stab-items" onclick="shopTab('items')">üéÆ √ñƒûELER</button>
      <button class="shop-tab" id="stab-effects" onclick="shopTab('effects')">‚ú® ƒ∞Sƒ∞M</button>
      <button class="shop-tab" id="stab-frames" onclick="shopTab('frames')">üñºÔ∏è √áER√áEVE</button>
    </div>
    <div id="shop-panel-items">
      <div class="shop-grid" id="shop-grid-items"></div>
    </div>
    <div id="shop-panel-effects" class="hidden">
      <div class="shop-grid" id="shop-grid-effects"></div>
    </div>
    <div id="shop-panel-frames" class="hidden">
      <div class="shop-grid" id="shop-grid-frames"></div>
    </div>
    <button class="btn-modal-full" onclick="closeModal('modal-shop')">KAPAT</button>
  </div>
</div>

<!-- Profile -->
<div class="modal-overlay hidden" id="modal-profile">
  <div class="modal">
    <div class="modal-title" id="prof-title" style="color:var(--blue)">PROFƒ∞L</div>
    <!-- Avatar big with frame -->
    <div style="text-align:center;margin-bottom:16px">
      <div class="avatar-big-container" id="prof-avatar-container">
        <div class="avatar-big-inner" id="prof-avatar" onclick="triggerPhotoUpload()" title="Fotoƒüraf y√ºkle">?</div>
        <div class="avatar-upload-hint" onclick="triggerPhotoUpload()" title="Fotoƒüraf deƒüi≈ütir">üì∑</div>
      </div>
      <div style="font-size:0.72rem;color:var(--text2);margin-top:6px">Fotoƒüraf y√ºklemek i√ßin tƒ±kla</div>
      <input type="file" id="photo-upload-input" accept="image/*" style="display:none" onchange="uploadProfilePhoto(this)">
    </div>
    <div class="profile-stat-row">
      <div class="profile-stat"><div class="profile-stat-v" id="prof-games">0</div><div class="profile-stat-l">Oyun</div></div>
      <div class="profile-stat"><div class="profile-stat-v" id="prof-wins">0</div><div class="profile-stat-l">Galibiyet</div></div>
      <div class="profile-stat"><div class="profile-stat-v" id="prof-wr">0%</div><div class="profile-stat-l">WR</div></div>
    </div>
    <div class="xp-section" style="margin-bottom:16px">
      <div class="xp-header"><div class="xp-level" id="prof-level">SEVƒ∞YE 1</div><div class="xp-text" id="prof-xp-txt">0 / 500 XP</div></div>
      <div class="xp-bar-bg"><div class="xp-bar-fill" id="prof-xp-bar" style="width:0%"></div></div>
    </div>
    <div id="prof-cosmetics" style="font-size:0.82rem;color:var(--text2);text-align:center;margin-bottom:16px"></div>
    <button class="btn-modal-full" onclick="closeModal('modal-profile')">KAPAT</button>
  </div>
</div>

<!-- Admin -->
<div class="modal-overlay hidden" id="modal-admin">
  <div class="modal" style="max-width:560px">
    <div class="modal-title" style="color:var(--blue)">‚öôÔ∏è ADMƒ∞N PANELƒ∞</div>
    <div class="auth-tabs" style="margin-bottom:20px">
      <button class="auth-tab active" id="adm-tab-coins" onclick="adminTab('coins')">üí∞ KULLANICI</button>
      <button class="auth-tab" id="adm-tab-questions" onclick="adminTab('questions')">‚ùì SORULAR</button>
    </div>
    <div id="adm-panel-coins">
      <div class="section-title">Kullanƒ±cƒ± Y√∂netimi</div>
      <div id="adm-user-list" style="max-height:420px;overflow-y:auto;"><div style="text-align:center;color:var(--text2);padding:20px">Y√ºkleniyor...</div></div>
    </div>
    <div id="adm-panel-questions" class="hidden">
      <div class="admin-form">
        <div class="form-group"><label class="form-label">Soru Metni</label><textarea class="form-input" id="adm-q" placeholder="Soru metni..." style="min-height:60px;resize:vertical"></textarea></div>
        <div class="form-group"><label class="form-label">A ≈ûƒ±kkƒ± (Doƒüru cevap)</label><input class="form-input" id="adm-a" placeholder="Doƒüru cevap"></div>
        <div class="form-group"><label class="form-label">B ≈ûƒ±kkƒ±</label><input class="form-input" id="adm-b" placeholder="Yanlƒ±≈ü ≈üƒ±k"></div>
        <div class="form-group"><label class="form-label">C ≈ûƒ±kkƒ±</label><input class="form-input" id="adm-c" placeholder="Yanlƒ±≈ü ≈üƒ±k"></div>
        <div class="form-group"><label class="form-label">D ≈ûƒ±kkƒ±</label><input class="form-input" id="adm-d" placeholder="Yanlƒ±≈ü ≈üƒ±k"></div>
        <div class="form-group"><label class="form-label">Zorluk</label><select class="form-input" id="adm-diff"><option value="easy">Kolay (1-5)</option><option value="medium">Orta (6-10)</option><option value="hard">Zor (11-15)</option></select></div>
        <button class="btn-auth" onclick="adminAddQ()">SORU EKLE</button>
      </div>
      <div class="admin-q-list" id="adm-q-list"></div>
    </div>
    <button class="btn-modal-full" onclick="closeModal('modal-admin')">KAPAT</button>
  </div>
</div>

<!-- FIREBASE SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, setPersistence, browserLocalPersistence, browserSessionPersistence } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, getDocs, query, orderBy, limit, onSnapshot, addDoc, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";


const firebaseConfig = {
  apiKey: "AIzaSyC5FaCS2m8Ko2O6Tqf6NkpV4wmg0yXqduA",
  authDomain: "quziora.firebaseapp.com",
  projectId: "quziora",
  storageBucket: "quziora.firebasestorage.app",
  messagingSenderId: "644228148321",
  appId: "1:644228148321:web:45d383e9465811af6d0e20",
  measurementId: "G-2Y93PDR1FG"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

window._FB = { auth, db, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, setPersistence, browserLocalPersistence, browserSessionPersistence, doc, getDoc, setDoc, updateDoc, collection, getDocs, query, orderBy, limit, onSnapshot, addDoc, deleteDoc, serverTimestamp };

let _userDocUnsub = null;

onAuthStateChanged(auth, async (user) => {
  if (user) {
    window._currentUID = user.uid;
    await window._loadUserData(user.uid);
    document.getElementById('loading-screen').classList.add('hidden');
    enterLobby();
    if (_userDocUnsub) _userDocUnsub();
    _userDocUnsub = onSnapshot(doc(db, 'users', user.uid), (snap) => {
      if (snap.exists()) {
        const prev = window._userData ? window._userData.coins : 0;
        window._userData = snap.data();
        const curr = window._userData.coins || 0;
        if (prev !== undefined && curr > prev) {
          const diff = curr - prev;
          if (typeof toast !== 'undefined') toast(`üéÅ Hesabƒ±na ${diff.toLocaleString()} coin eklendi!`, 'gold');
        }
        if (typeof updateLobbyUI !== 'undefined') updateLobbyUI();
      }
    });
  } else {
    window._currentUID = null;
    window._userData = null;
    if (_userDocUnsub) { _userDocUnsub(); _userDocUnsub = null; }
    document.getElementById('loading-screen').classList.add('hidden');
    showScreen('auth');
  }
});

window._listenQuestions = function() {
  const q = query(collection(db, 'questions'));
  return onSnapshot(q, (snap) => {
    window._cachedQuestions = snap.docs.map(d => ({ id: d.id, ...d.data() }));
  });
};
window._listenQuestions();
</script>

<script>
// =====================================================================
// QUIZORA ‚Äî FULL GAME ENGINE v2.0
// =====================================================================

window._userData = null;
window._currentUID = null;
window._cachedQuestions = null;

window._loadUserData = async function(uid) {
  const { db, doc, getDoc } = window._FB;
  const snap = await getDoc(doc(db, 'users', uid));
  if (snap.exists()) window._userData = snap.data();
  return window._userData;
};

window._saveUserData = async function(updates) {
  if (!window._currentUID) return;
  const { db, doc, updateDoc } = window._FB;
  Object.assign(window._userData, updates);
  await updateDoc(doc(db, 'users', window._currentUID), updates);
};

// ‚îÄ‚îÄ‚îÄ Stars ‚îÄ‚îÄ‚îÄ
(function() {
  const c = document.getElementById('bg-stars');
  for (let i = 0; i < 80; i++) {
    const s = document.createElement('div');
    s.className = 'star';
    s.style.cssText = `left:${Math.random()*100}%;top:${Math.random()*100}%;width:${1+Math.random()*2}px;height:${1+Math.random()*2}px;--d:${2+Math.random()*4}s;--op:${0.3+Math.random()*0.5};animation-delay:${Math.random()*5}s;`;
    c.appendChild(s);
  }
})();

// ‚îÄ‚îÄ‚îÄ Levels / XP ‚îÄ‚îÄ‚îÄ
const LEVELS = [
  {level:1,name:'√áaylak',min:0,max:500},
  {level:2,name:'Acemi',min:500,max:1500},
  {level:3,name:'Oyuncu',min:1500,max:3000},
  {level:4,name:'Usta',min:3000,max:5500},
  {level:5,name:'Uzman',min:5500,max:9000},
  {level:6,name:'Efsane',min:9000,max:14000},
  {level:7,name:'Grandmaster',min:14000,max:21000},
  {level:8,name:'Tanrƒ±',min:21000,max:Infinity}
];
function getLevelInfo(xp) {
  let lv = LEVELS[0];
  for (const l of LEVELS) { if (xp >= l.min) lv = l; else break; }
  return lv;
}
function getXpPercent(xp) {
  const lv = getLevelInfo(xp);
  if (lv.max === Infinity) return 100;
  return Math.round(((xp - lv.min) / (lv.max - lv.min)) * 100);
}

const XP_TABLE = [5,5,8,8,10,12,15,18,20,25,30,35,40,50,75];
const PRIZE_TABLE = [100,200,300,500,1000,2000,4000,8000,16000,32000,64000,125000,250000,500000,1000000];
const COIN_TABLE = [10,15,20,30,50,80,120,180,250,350,500,700,1000,1500,2500];
const BARRIERS = [4,9];

// ‚îÄ‚îÄ‚îÄ Name Effects Definition ‚îÄ‚îÄ‚îÄ
const NAME_EFFECTS = [
  {id:'ne_gradient', name:'üåà Gradient', desc:'G√∂kku≈üaƒüƒ± renk ge√ßi≈üi', price:10000, cssClass:'ne-gradient', preview:'<span class="ne-gradient name-effect-preview">√ñRNEKƒ∞Sƒ∞M</span>'},
  {id:'ne_neon', name:'üíö Neon Ye≈üil', desc:'Neon glow efekti', price:10000, cssClass:'ne-neon', preview:'<span class="ne-neon name-effect-preview">√ñRNEKƒ∞Sƒ∞M</span>'},
  {id:'ne_blink', name:'üîÜ Yanƒ±p S√∂nen', desc:'Dikkat √ßekici yanƒ±p s√∂nme', price:10000, cssClass:'ne-blink', preview:'<span class="ne-blink name-effect-preview">√ñRNEKƒ∞Sƒ∞M</span>'},
  {id:'ne_fire', name:'üî• Ate≈ü', desc:'Ate≈üli renk efekti', price:10000, cssClass:'ne-fire', preview:'<span class="ne-fire name-effect-preview">√ñRNEKƒ∞Sƒ∞M</span>'},
  {id:'ne_shine', name:'‚ú® Parlayan', desc:'I≈üƒ±k kayma animasyonu', price:10000, cssClass:'ne-shine', preview:'<span class="ne-shine name-effect-preview">√ñRNEKƒ∞Sƒ∞M</span>'},
  {id:'ne_rainbow', name:'üåà G√∂kku≈üaƒüƒ±', desc:'Hƒ±zlƒ± renk d√∂ng√ºs√º', price:10000, cssClass:'ne-rainbow', preview:'<span class="ne-rainbow name-effect-preview">√ñRNEKƒ∞Sƒ∞M</span>'},
  {id:'ne_ice', name:'‚ùÑÔ∏è Buz', desc:'Soƒüuk neon mavi parlaklƒ±k', price:10000, cssClass:'ne-ice', preview:'<span class="ne-ice name-effect-preview">√ñRNEKƒ∞Sƒ∞M</span>'},
  {id:'ne_gold', name:'ü•á Altƒ±n', desc:'Altƒ±n parlaklƒ±k ge√ßi≈üi', price:10000, cssClass:'ne-gold', preview:'<span class="ne-gold name-effect-preview">√ñRNEKƒ∞Sƒ∞M</span>'},
];

// ‚îÄ‚îÄ‚îÄ Profile Frames Definition ‚îÄ‚îÄ‚îÄ
const PROFILE_FRAMES = [
  {id:'pf_gold', name:'ü•á Altƒ±n √áer√ßeve', desc:'D√∂nen altƒ±n √ßer√ßeve', price:20000, frameClass:'frame-gold', preview:'frame-gold'},
  {id:'pf_neon', name:'üí´ Neon √áer√ßeve', desc:'Neon ƒ±≈üƒ±klƒ± √ßer√ßeve', price:20000, frameClass:'frame-neon', preview:'frame-neon'},
  {id:'pf_fire', name:'üî• Alevli √áer√ßeve', desc:'Ate≈ü efektli √ßer√ßeve', price:20000, frameClass:'frame-fire', preview:'frame-fire'},
  {id:'pf_spin', name:'üåÄ D√∂nen √áer√ßeve', desc:'Renkli d√∂nen √ßer√ßeve', price:20000, frameClass:'frame-spin', preview:'frame-spin'},
  {id:'pf_diamond', name:'üíé Elmas √áer√ßeve', desc:'Elmas parlaklƒ±k √ßer√ßevesi', price:20000, frameClass:'frame-diamond', preview:'frame-diamond'},
];

// ‚îÄ‚îÄ‚îÄ Standard Shop Items ‚îÄ‚îÄ‚îÄ
const SHOP_ITEMS = [
  {id:'double_joker', icon:'‚úåÔ∏è', name:'√áift Cevap Jokeri', desc:'Bir oyunda 2 ≈üƒ±k i≈üaretle (tek kullanƒ±m)', price:5000, type:'consumable'},
  {id:'xp_boost_24h', icon:'‚ö°', name:'24 Saat 2x XP', desc:'24 saat boyunca √ßift XP kazan', price:10000, type:'boost24'},
  {id:'vip_badge', icon:'üëë', name:'VIP Rozeti', desc:'Profilinde VIP rozeti', price:7500, type:'badge'},
  {id:'legend_badge', icon:'üèÜ', name:'Efsane Rozeti', desc:'Efsane oyuncu unvanƒ±', price:15000, type:'badge'},
  {id:'season_badge', icon:'üåü', name:'Sezon Rozeti', desc:'Bu sezonun √∂zel rozeti', price:12500, type:'badge'},
];

// ‚îÄ‚îÄ‚îÄ XP Boost Helpers ‚îÄ‚îÄ‚îÄ
function isXpBoostActive() {
  const u = window._userData;
  if (!u || !u.xpBoostUntil) return false;
  return Date.now() < u.xpBoostUntil;
}

function getXpBoostTimeLeft() {
  const u = window._userData;
  if (!u || !u.xpBoostUntil) return 0;
  return Math.max(0, u.xpBoostUntil - Date.now());
}

function formatBoostTimer(ms) {
  if (ms <= 0) return '';
  const h = Math.floor(ms / 3600000);
  const m = Math.floor((ms % 3600000) / 60000);
  return h > 0 ? `${h}s ${m}d` : `${m}d`;
}

let _boostTimerInterval = null;
function startBoostTimer() {
  if (_boostTimerInterval) clearInterval(_boostTimerInterval);
  _boostTimerInterval = setInterval(() => {
    const el = document.getElementById('hdr-xpboost');
    const timerEl = document.getElementById('hdr-boost-timer');
    if (!el) return;
    if (isXpBoostActive()) {
      el.classList.remove('hidden');
      if (timerEl) timerEl.textContent = formatBoostTimer(getXpBoostTimeLeft());
    } else {
      el.classList.add('hidden');
      clearInterval(_boostTimerInterval);
    }
  }, 1000);
}

// ‚îÄ‚îÄ‚îÄ Apply Name Effect to element ‚îÄ‚îÄ‚îÄ
function applyNameEffect(el, username, effect) {
  if (!el) return;
  const eff = NAME_EFFECTS.find(e => e.id === effect);
  // Clear old classes
  NAME_EFFECTS.forEach(e => el.classList.remove(e.cssClass));
  el.textContent = username;
  if (eff) el.classList.add(eff.cssClass);
}

// ‚îÄ‚îÄ‚îÄ Apply Avatar Frame ‚îÄ‚îÄ‚îÄ
function applyFrame(container, frameId) {
  // Remove old frame classes
  PROFILE_FRAMES.forEach(f => container.classList.remove(f.frameClass));
  container.classList.remove('has-frame');
  if (frameId) {
    const fr = PROFILE_FRAMES.find(f => f.id === frameId);
    if (fr) {
      container.classList.add('has-frame', fr.frameClass);
    }
  }
}

// ‚îÄ‚îÄ‚îÄ Get avatar inner HTML ‚îÄ‚îÄ‚îÄ
function getAvatarHTML(u, size='small') {
  if (u && u.photoURL) {
    return `<img src="${u.photoURL}" alt="avatar">`;
  }
  return (u && u.username) ? u.username[0].toUpperCase() : '?';
}

// ‚îÄ‚îÄ‚îÄ TTS ‚îÄ‚îÄ‚îÄ
const TTS = {
  synth: window.speechSynthesis,
  selectedVoice: null, allVoices: [], enabled: true,
  init() {
    const load = () => {
      this.allVoices = this.synth.getVoices();
      const saved = localStorage.getItem('qz_tts_voice');
      if (saved) this.selectedVoice = this.allVoices.find(v => v.name === saved) || null;
      if (!this.selectedVoice) this.selectedVoice = this.allVoices.find(v => v.lang.startsWith('tr')) || this.allVoices[0] || null;
    };
    this.synth.onvoiceschanged = load; load();
    this.enabled = localStorage.getItem('qz_tts_enabled') !== 'false';
  },
  setVoice(name) { const v = this.allVoices.find(v => v.name === name); if (v) { this.selectedVoice = v; localStorage.setItem('qz_tts_voice', name); } },
  stop() { this.synth.cancel(); },
  speak(text, rate=1, pitch=1) {
    if (!this.enabled) return Promise.resolve();
    return new Promise(resolve => {
      this.stop();
      const savedRate = parseFloat(localStorage.getItem('qz_tts_rate') || '0.9');
      const u = new SpeechSynthesisUtterance(text);
      u.lang = this.selectedVoice ? this.selectedVoice.lang : 'tr-TR';
      u.rate = savedRate * rate; u.pitch = pitch;
      if (this.selectedVoice) u.voice = this.selectedVoice;
      u.onend = resolve; u.onerror = resolve;
      this.synth.speak(u);
    });
  },
  async readQuestion(q, answers) {
    G.inputLocked = true; updateAnswerState();
    await this.speak(q, 0.9, 1.0); await delay(200);
    const letters = ['A','B','C','D'];
    for (let i = 0; i < answers.length; i++) { await this.speak(`${letters[i]}... ${answers[i]}`, 0.9, 1.0); await delay(100); }
    G.inputLocked = false; updateAnswerState();
  },
  async sayCorrect() {
    const phrases = ['Harika bir cevap!','M√ºkemmel gidiyorsun!','Doƒüru cevap, devam edelim!','Muhte≈üem performans!'];
    await this.speak(phrases[Math.floor(Math.random()*phrases.length)], 1.0, 1.0);
  },
  async sayWrong(correctAnswer) {
    await this.speak('Maalesef yanlƒ±≈ü cevap.', 0.95, 0.95);
    await delay(200);
    await this.speak(`Doƒüru cevap: ${correctAnswer}`, 0.95, 1.0);
  }
};

// ‚îÄ‚îÄ‚îÄ BGM ‚îÄ‚îÄ‚îÄ
const BGM = {
  ctx:null, gainNode:null, volume:0.12, playing:false,
  init() { try { if(this.ctx) return; this.ctx = new (window.AudioContext||window.webkitAudioContext)(); this.gainNode = this.ctx.createGain(); this.gainNode.gain.value = 0; this.gainNode.connect(this.ctx.destination); } catch(e){} },
  play() { if(!this.ctx||this.playing)return; this.playing=true; this.gainNode.gain.setTargetAtTime(this.volume,this.ctx.currentTime,1); this._loop(); },
  stop() { if(!this.gainNode)return; this.gainNode.gain.setTargetAtTime(0,this.ctx.currentTime,0.5); this.playing=false; },
  _loop() {
    if(!this.playing||!this.ctx)return;
    const now=this.ctx.currentTime,notes=[220,246.94,261.63,293.66,329.63,349.23,392,440],pattern=[0,2,4,5,7,5,4,2,0];
    let t=now;
    pattern.forEach(ni=>{const osc=this.ctx.createOscillator(),g=this.ctx.createGain();osc.connect(g);g.connect(this.gainNode);osc.frequency.value=notes[ni%notes.length];osc.type='sine';g.gain.setValueAtTime(0,t);g.gain.linearRampToValueAtTime(0.4,t+0.05);g.gain.exponentialRampToValueAtTime(0.001,t+0.3);osc.start(t);osc.stop(t+0.35);t+=0.6;});
    setTimeout(()=>this._loop(),(t-now)*1000);
  },
  correct() { if(!this.ctx)return;const now=this.ctx.currentTime;[523.25,659.25,783.99].forEach((f,i)=>{const o=this.ctx.createOscillator(),g=this.ctx.createGain();o.connect(g);g.connect(this.ctx.destination);o.frequency.value=f;o.type='triangle';const t=now+i*0.12;g.gain.setValueAtTime(0,t);g.gain.linearRampToValueAtTime(0.3,t+0.03);g.gain.exponentialRampToValueAtTime(0.001,t+0.4);o.start(t);o.stop(t+0.45);}); },
  wrong() { if(!this.ctx)return;const now=this.ctx.currentTime;[220,196,175].forEach((f,i)=>{const o=this.ctx.createOscillator(),g=this.ctx.createGain();o.connect(g);g.connect(this.ctx.destination);o.frequency.value=f;o.type='sawtooth';const t=now+i*0.15;g.gain.setValueAtTime(0,t);g.gain.linearRampToValueAtTime(0.2,t+0.05);g.gain.exponentialRampToValueAtTime(0.001,t+0.5);o.start(t);o.stop(t+0.55);}); }
};

// ‚îÄ‚îÄ‚îÄ Utils ‚îÄ‚îÄ‚îÄ
const delay = ms => new Promise(r => setTimeout(r, ms));

function toast(msg, type='info') {
  const c = document.getElementById('toast-container');
  const t = document.createElement('div');
  t.className = `toast ${type}`; t.textContent = msg; c.appendChild(t);
  setTimeout(()=>{ t.style.opacity='0'; t.style.transform='translateX(30px)'; setTimeout(()=>t.remove(),400); }, 3000);
}

function showEffect(txt, cls) {
  const o = document.getElementById('effect-overlay'), t = document.getElementById('effect-text');
  t.textContent = txt; t.className = `effect-text ${cls}`;
  o.classList.remove('hidden');
  setTimeout(()=>o.classList.add('hidden'), 1700);
}

function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
function showScreen(name) {
  ['auth','lobby','game'].forEach(s=>document.getElementById(s+'-screen').classList.add('hidden'));
  document.getElementById(name+'-screen').classList.remove('hidden');
}

// ‚îÄ‚îÄ‚îÄ Auth ‚îÄ‚îÄ‚îÄ
function toEmail(username) { return username.toLowerCase() + '@quizora.game'; }
let authMode = 'login';
function authTab(mode) {
  authMode = mode;
  document.querySelectorAll('.auth-tab').forEach((b,i) => b.classList.toggle('active',(i===0&&mode==='login')||(i===1&&mode==='register')));
  document.getElementById('login-form').classList.toggle('hidden', mode!=='login');
  document.getElementById('register-form').classList.toggle('hidden', mode!=='register');
  document.getElementById('auth-err').textContent = '';
}
function setAuthErr(msg) { document.getElementById('auth-err').textContent = msg; }
function checkStrength(p) {
  let score=0;
  if(p.length>=6)score++;if(p.length>=10)score++;if(/[A-Z]/.test(p))score++;if(/[0-9]/.test(p))score++;if(/[^A-Za-z0-9]/.test(p))score++;
  const fill=document.getElementById('strength-fill');
  const colors=['#ff3355','#ff8c00','#ffaa00','#00d4aa','#00ff88'];
  fill.style.width=(score/5*100)+'%';fill.style.background=colors[score-1]||'#ff3355';
}
function validateUser(u) {
  if(!u||u.length<3)return 'Kullanƒ±cƒ± adƒ± en az 3 karakter olmalƒ±.';
  if(u.length>20)return 'Kullanƒ±cƒ± adƒ± max 20 karakter.';
  if(!/^[a-zA-Z0-9_]+$/.test(u))return 'Sadece harf, rakam ve _ kullanƒ±labilir.';
  return null;
}

async function doRegister() {
  const u = document.getElementById('r-user').value.trim();
  const p = document.getElementById('r-pass').value;
  const p2 = document.getElementById('r-pass2').value;
  const ue = validateUser(u);
  if (ue) return setAuthErr(ue);
  if (!p||p.length<6) return setAuthErr('≈ûifre en az 6 karakter olmalƒ±.');
  if (p !== p2) return setAuthErr('≈ûifreler e≈üle≈ümiyor.');
  const { auth, db, createUserWithEmailAndPassword, doc, setDoc, collection, getDocs, serverTimestamp } = window._FB;
  try {
    const email = toEmail(u);
    const cred = await createUserWithEmailAndPassword(auth, email, p);
    const uid = cred.user.uid;
    const snap = await getDocs(collection(db, 'users'));
    const taken = snap.docs.some(d => d.data().username && d.data().username.toLowerCase() === u.toLowerCase() && d.id !== uid);
    if (taken) { setAuthErr('Bu kullanƒ±cƒ± adƒ± zaten alƒ±nmƒ±≈ü.'); return; }
    await setDoc(doc(db, 'users', uid), {
      username: u, xp: 0, coins: 0, wins: 0, losses: 0, games: 0,
      items: [], activeNameEffect: null, activeFrame: null,
      photoURL: null, xpBoostUntil: null, joined: serverTimestamp()
    });
    setAuthErr('');
  } catch(e) {
    if (e.code === 'auth/email-already-in-use') setAuthErr('Bu kullanƒ±cƒ± adƒ± zaten alƒ±nmƒ±≈ü.');
    else setAuthErr('Hata: ' + e.message);
  }
}

async function doLogin() {
  const u = document.getElementById('l-user').value.trim();
  const p = document.getElementById('l-pass').value;
  if (!u||!p) return setAuthErr('T√ºm alanlarƒ± doldurun.');
  const { auth, setPersistence, browserLocalPersistence, browserSessionPersistence, signInWithEmailAndPassword } = window._FB;
  const remember = document.getElementById('l-remember').checked;
  try {
    await setPersistence(auth, remember ? browserLocalPersistence : browserSessionPersistence);
    await signInWithEmailAndPassword(auth, toEmail(u), p);
    setAuthErr('');
  } catch(e) {
    if (e.code === 'auth/user-not-found' || e.code === 'auth/invalid-credential') setAuthErr('Kullanƒ±cƒ± adƒ± veya ≈üifre hatalƒ±.');
    else if (e.code === 'auth/wrong-password') setAuthErr('≈ûifre hatalƒ±.');
    else setAuthErr('Giri≈ü hatasƒ±: ' + e.message);
  }
}

async function doLogout() {
  TTS.stop(); BGM.stop();
  const { auth, signOut } = window._FB;
  await signOut(auth);
}

// ‚îÄ‚îÄ‚îÄ Profile Photo Upload ‚îÄ‚îÄ‚îÄ
function triggerPhotoUpload() {
  document.getElementById('photo-upload-input').click();
}

async function uploadProfilePhoto(input) {
  if (!input.files || !input.files[0]) return;
  const file = input.files[0];
  if (!file.type.startsWith('image/')) return toast('L√ºtfen bir resim dosyasƒ± se√ßin!', 'error');

  toast('üì∑ Fotoƒüraf y√ºkleniyor...', 'info');
  try {
    // Canvas ile k√º√ß√ºlt ve base64'e √ßevir (Storage gerekmez)
    const base64 = await imageToBase64(file, 128, 128);

    // Firestore'a base64 olarak kaydet
    await window._saveUserData({ photoURL: base64 });

    // UI'ƒ± anƒ±nda g√ºncelle
    forceAvatarUpdate(base64);

    toast('‚úÖ Fotoƒüraf g√ºncellendi!', 'success');
    input.value = '';
  } catch(e) {
    console.error('Photo error:', e);
    toast('Hata: ' + (e.message || 'Fotoƒüraf y√ºklenemedi'), 'error');
  }
}

// Resmi canvas'ta k√º√ß√ºlt√ºp base64 string d√∂nd√ºr
function imageToBase64(file, maxW, maxH) {
  return new Promise((resolve, reject) => {
    const img = new Image();
    const url = URL.createObjectURL(file);
    img.onload = () => {
      URL.revokeObjectURL(url);
      const canvas = document.createElement('canvas');
      let w = img.width, h = img.height;
      const ratio = Math.min(maxW / w, maxH / h);
      if (ratio < 1) { w = Math.round(w * ratio); h = Math.round(h * ratio); }
      canvas.width = w; canvas.height = h;
      const ctx = canvas.getContext('2d');
      // Dairesel kƒ±rpma
      ctx.beginPath();
      ctx.arc(w/2, h/2, Math.min(w,h)/2, 0, Math.PI*2);
      ctx.clip();
      ctx.drawImage(img, 0, 0, w, h);
      resolve(canvas.toDataURL('image/jpeg', 0.75));
    };
    img.onerror = () => { URL.revokeObjectURL(url); reject(new Error('Resim y√ºklenemedi')); };
    img.src = url;
  });
}

// T√ºm avatar elementlerini anƒ±nda g√ºncelle (Firestore snapshot beklemeden)
function forceAvatarUpdate(photoURL) {
  // Header avatar
  const avatarInner = document.getElementById('hdr-avatar');
  if (avatarInner) {
    avatarInner.innerHTML = `<img src="${photoURL}" alt="avatar" crossorigin="anonymous" onerror="this.parentElement.textContent=window._userData?.username?.[0]?.toUpperCase()||'?'">`;
  }
  // Profile modal avatar
  const profInner = document.getElementById('prof-avatar');
  if (profInner) {
    profInner.innerHTML = `<img src="${photoURL}" alt="avatar" crossorigin="anonymous" onerror="this.parentElement.textContent=window._userData?.username?.[0]?.toUpperCase()||'?'">`;
  }
}

// ‚îÄ‚îÄ‚îÄ Lobby ‚îÄ‚îÄ‚îÄ
function enterLobby() {
  showScreen('lobby');
  updateLobbyUI();
  if (isXpBoostActive()) startBoostTimer();
}

function updateLobbyUI() {
  const u = window._userData;
  if (!u) return;
  const lv = getLevelInfo(u.xp||0);
  const pct = getXpPercent(u.xp||0);

  // Avatar
  const avatarContainer = document.getElementById('hdr-avatar-container');
  const avatarInner = document.getElementById('hdr-avatar');
  if (u.photoURL) {
    avatarInner.innerHTML = `<img src="${u.photoURL}" alt="avatar" crossorigin="anonymous" onerror="this.parentElement.textContent='${u.username[0].toUpperCase()}'">`;
  } else {
    avatarInner.textContent = u.username[0].toUpperCase();
  }
  applyFrame(avatarContainer, u.activeFrame);

  // Name with effect
  const nameEl = document.getElementById('hdr-name');
  applyNameEffect(nameEl, u.username, u.activeNameEffect);

  document.getElementById('hdr-level').textContent = `LVL ${lv.level} ‚Äî ${lv.name}`;
  document.getElementById('hdr-wallet').textContent = (u.coins||0).toLocaleString();
  document.getElementById('s-games').textContent = u.games||0;
  document.getElementById('s-wins').textContent = u.wins||0;
  document.getElementById('s-xp').textContent = (u.xp||0).toLocaleString();
  document.getElementById('s-money').textContent = (u.coins||0).toLocaleString();
  document.getElementById('xp-level-display').textContent = `SEVƒ∞YE ${lv.level} ‚Äî ${lv.name}`;
  document.getElementById('xp-progress-text').textContent = `${(u.xp||0).toLocaleString()} / ${lv.max===Infinity?'‚àû':lv.max.toLocaleString()} XP`;
  document.getElementById('xp-bar').style.width = pct + '%';

  const adminBtn = document.getElementById('admin-btn');
  if (adminBtn) adminBtn.style.display = u.username.toLowerCase() === 'ercanulger' ? 'block' : 'none';

  // XP Boost indicator
  const boostEl = document.getElementById('hdr-xpboost');
  const boostTimer = document.getElementById('hdr-boost-timer');
  if (isXpBoostActive()) {
    boostEl.classList.remove('hidden');
    if (boostTimer) boostTimer.textContent = formatBoostTimer(getXpBoostTimeLeft());
    startBoostTimer();
  } else {
    boostEl.classList.add('hidden');
  }
}

// ‚îÄ‚îÄ‚îÄ Leaderboard ‚îÄ‚îÄ‚îÄ
let _lbUnsub = null;
function openLeaderboard() {
  const { db, collection, query, orderBy, limit, onSnapshot } = window._FB;
  const me = window._userData?.username?.toLowerCase();
  if (_lbUnsub) _lbUnsub();
  const q = query(collection(db, 'users'), orderBy('xp','desc'), limit(20));
  _lbUnsub = onSnapshot(q, (snap) => {
    const users = snap.docs.map(d => d.data());
    const medals = ['ü•á','ü•à','ü•â'];
    const list = document.getElementById('lb-list');
    list.innerHTML = users.length === 0
      ? '<div style="text-align:center;color:var(--text2);padding:20px">Hen√ºz kayƒ±tlƒ± kullanƒ±cƒ± yok.</div>'
      : users.map((u,i) => {
          const iMe = u.username?.toLowerCase() === me;
          const cls = i<3 ? 'top'+(i+1) : '';
          const wr = (u.games||0) > 0 ? Math.round((u.wins||0)/(u.games||1)*100) : 0;

          // Frame class
          const frameCls = u.activeFrame
            ? PROFILE_FRAMES.find(f=>f.id===u.activeFrame)?.frameClass || ''
            : '';
          const hasFrame = frameCls ? 'has-frame' : '';

          // Name effect
          const nameEff = u.activeNameEffect
            ? NAME_EFFECTS.find(e=>e.id===u.activeNameEffect)?.cssClass || ''
            : '';

          // Avatar content
          const avContent = u.photoURL
            ? `<img src="${u.photoURL}" alt="avatar" crossorigin="anonymous" onerror="this.style.display='none';this.parentElement.textContent='${(u.username||'?')[0].toUpperCase()}'">` 
            : (u.username||'?')[0].toUpperCase();

          return `<div class="lb-row ${cls} ${iMe?'me':''}">
            <div class="lb-rank">${i<3?medals[i]:'#'+(i+1)}</div>
            <div class="lb-av-container ${hasFrame} ${frameCls}">
              <div class="lb-av-inner">${avContent}</div>
            </div>
            <div class="lb-name">
              <span class="${nameEff}">${u.username||'?'}${iMe?' (sen)':''}</span>
              ${u.items&&u.items.includes('vip_badge')?'<span style="color:var(--gold);font-size:0.7rem;margin-left:4px">üëë</span>':''}
              ${u.items&&u.items.includes('legend_badge')?'<span style="color:var(--red);font-size:0.7rem;margin-left:2px">üèÜ</span>':''}
              ${isXpBoostActiveFor(u)?'<span class="xpboost-indicator" style="margin-left:6px;font-size:0.65rem">‚ö°2x</span>':''}
            </div>
            <div style="text-align:right">
              <div class="lb-xp">‚≠ê ${(u.xp||0).toLocaleString()}</div>
              <div class="lb-wr">${wr}% WR | ${u.games||0} oyun</div>
            </div>
          </div>`;
        }).join('');
  });
  openModal('modal-lb');
}

function isXpBoostActiveFor(u) {
  return u && u.xpBoostUntil && Date.now() < u.xpBoostUntil;
}

// ‚îÄ‚îÄ‚îÄ Shop ‚îÄ‚îÄ‚îÄ
let _currentShopTab = 'items';

function shopTab(tab) {
  _currentShopTab = tab;
  ['items','effects','frames'].forEach(t => {
    document.getElementById('shop-panel-'+t).classList.toggle('hidden', t!==tab);
    document.getElementById('stab-'+t).classList.toggle('active', t===tab);
  });
  renderShopTab(tab);
}

function openShop() {
  document.getElementById('shop-balance').textContent = (window._userData?.coins||0).toLocaleString();
  shopTab('items');
  openModal('modal-shop');
}

function renderShopTab(tab) {
  const u = window._userData;
  if (tab === 'items') {
    const grid = document.getElementById('shop-grid-items');
    grid.innerHTML = SHOP_ITEMS.map(item => {
      const owned = (u.items||[]).includes(item.id);
      const isBoost = item.type === 'boost24';
      const isConsumable = item.type === 'consumable';
      const boostActive = isBoost && isXpBoostActive();

      let actionHTML = '';
      if (isBoost && boostActive) {
        actionHTML = `<div class="shop-active-badge">‚ö° AKTƒ∞F ‚Äî ${formatBoostTimer(getXpBoostTimeLeft())}</div>`;
      } else if (isConsumable) {
        // Double joker: can always buy
        const hasJoker = (u.doubleJokerCount || 0) > 0;
        actionHTML = hasJoker
          ? `<div style="margin-top:4px"><div style="color:var(--green);font-size:0.78rem">‚úì ${u.doubleJokerCount}x joker var</div><button onclick="buyShopItem('${item.id}')" style="background:none;border:none;cursor:pointer;width:100%;margin-top:4px"><div class="shop-price">üí∞ ${item.price.toLocaleString()}</div></button></div>`
          : `<button onclick="buyShopItem('${item.id}')" style="background:none;border:none;cursor:pointer;width:100%"><div class="shop-price">üí∞ ${item.price.toLocaleString()}</div></button>`;
      } else if (owned) {
        actionHTML = '<div class="shop-owned">‚úì SAHƒ∞PSƒ∞N</div>';
      } else {
        actionHTML = `<button onclick="buyShopItem('${item.id}')" style="background:none;border:none;cursor:pointer;width:100%"><div class="shop-price">üí∞ ${item.price.toLocaleString()}</div></button>`;
      }

      return `<div class="shop-item ${owned&&!isConsumable?'owned':''}">
        <div class="shop-icon">${item.icon}</div>
        <div class="shop-name">${item.name}</div>
        <div class="shop-desc">${item.desc}</div>
        ${actionHTML}
      </div>`;
    }).join('');
  }

  if (tab === 'effects') {
    const grid = document.getElementById('shop-grid-effects');
    const activeEff = u.activeNameEffect;
    grid.innerHTML = NAME_EFFECTS.map(item => {
      const owned = (u.items||[]).includes(item.id);
      const isActive = activeEff === item.id;
      let actionHTML = '';
      if (!owned) {
        actionHTML = `<button onclick="buyShopItem('${item.id}')" style="background:none;border:none;cursor:pointer;width:100%"><div class="shop-price">üí∞ ${item.price.toLocaleString()}</div></button>`;
      } else if (isActive) {
        actionHTML = `<div class="shop-btn-row"><div class="shop-active-badge">‚úì AKTƒ∞F</div><button class="shop-btn-deactivate" onclick="deactivateEffect()">KAPAT</button></div>`;
      } else {
        actionHTML = `<div class="shop-btn-row"><div class="shop-owned">‚úì Sahipsin</div><button class="shop-btn-activate" onclick="activateEffect('${item.id}')">AKTƒ∞FLE≈ûTƒ∞R</button></div>`;
      }
      return `<div class="shop-item ${owned?'owned':''} ${isActive?'active-effect':''}">
        ${item.preview}
        <div class="shop-name">${item.name}</div>
        <div class="shop-desc">${item.desc}</div>
        ${actionHTML}
      </div>`;
    }).join('');
  }

  if (tab === 'frames') {
    const grid = document.getElementById('shop-grid-frames');
    const activeFr = u.activeFrame;
    grid.innerHTML = PROFILE_FRAMES.map(item => {
      const owned = (u.items||[]).includes(item.id);
      const isActive = activeFr === item.id;
      let actionHTML = '';
      if (!owned) {
        actionHTML = `<button onclick="buyShopItem('${item.id}')" style="background:none;border:none;cursor:pointer;width:100%"><div class="shop-price">üí∞ ${item.price.toLocaleString()}</div></button>`;
      } else if (isActive) {
        actionHTML = `<div class="shop-btn-row"><div class="shop-active-badge">‚úì AKTƒ∞F</div><button class="shop-btn-deactivate" onclick="deactivateFrame()">KAPAT</button></div>`;
      } else {
        actionHTML = `<div class="shop-btn-row"><div class="shop-owned">‚úì Sahipsin</div><button class="shop-btn-activate" onclick="activateFrame('${item.id}')">AKTƒ∞FLE≈ûTƒ∞R</button></div>`;
      }
      // Frame preview
      const preview = `<div class="frame-preview has-frame ${item.frameClass}"><div class="frame-preview-inner">üòä</div></div>`;
      return `<div class="shop-item ${owned?'owned':''} ${isActive?'active-effect':''}">
        ${preview}
        <div class="shop-name">${item.name}</div>
        <div class="shop-desc">${item.desc}</div>
        ${actionHTML}
      </div>`;
    }).join('');
  }
}

async function buyShopItem(id) {
  const u = window._userData;
  const item = [...SHOP_ITEMS, ...NAME_EFFECTS, ...PROFILE_FRAMES].find(i=>i.id===id);
  if (!item) return;
  if ((u.coins||0) < item.price) return toast('Yetersiz bakiye!', 'error');

  // Consumable: double joker
  if (item.type === 'consumable') {
    const newCoins = (u.coins||0) - item.price;
    const newCount = (u.doubleJokerCount || 0) + 1;
    await window._saveUserData({ coins: newCoins, doubleJokerCount: newCount });
    toast(`‚úåÔ∏è √áift Cevap Jokeri satƒ±n alƒ±ndƒ±! (${newCount}x)`, 'gold');
    renderShopTab(_currentShopTab);
    updateLobbyUI();
    return;
  }

  // XP Boost 24h
  if (item.type === 'boost24') {
    if (isXpBoostActive()) return toast('Boost zaten aktif!', 'info');
    const newCoins = (u.coins||0) - item.price;
    const boostUntil = Date.now() + 24 * 60 * 60 * 1000;
    await window._saveUserData({ coins: newCoins, xpBoostUntil: boostUntil });
    toast('‚ö° 24 Saatlik 2x XP Boost aktif!', 'gold');
    startBoostTimer();
    renderShopTab(_currentShopTab);
    updateLobbyUI();
    return;
  }

  // One-time purchase items
  if ((u.items||[]).includes(id)) return toast('Zaten sahipsin!', 'info');
  const newCoins = (u.coins||0) - item.price;
  const newItems = [...(u.items||[]), id];
  await window._saveUserData({ coins: newCoins, items: newItems });
  toast(`${item.icon||'‚ú®'} ${item.name} satƒ±n alƒ±ndƒ±!`, 'gold');
  renderShopTab(_currentShopTab);
  updateLobbyUI();
}

async function activateEffect(id) {
  await window._saveUserData({ activeNameEffect: id });
  toast('‚ú® ƒ∞sim efekti aktifle≈ütirildi!', 'success');
  renderShopTab('effects');
  updateLobbyUI();
}

async function deactivateEffect() {
  await window._saveUserData({ activeNameEffect: null });
  toast('ƒ∞sim efekti kapatƒ±ldƒ±.', 'info');
  renderShopTab('effects');
  updateLobbyUI();
}

async function activateFrame(id) {
  await window._saveUserData({ activeFrame: id });
  toast('üñºÔ∏è √áer√ßeve aktifle≈ütirildi!', 'success');
  renderShopTab('frames');
  updateLobbyUI();
}

async function deactivateFrame() {
  await window._saveUserData({ activeFrame: null });
  toast('√áer√ßeve kapatƒ±ldƒ±.', 'info');
  renderShopTab('frames');
  updateLobbyUI();
}

// ‚îÄ‚îÄ‚îÄ Profile ‚îÄ‚îÄ‚îÄ
function openProfile() {
  const u = window._userData;
  const lv = getLevelInfo(u.xp||0);
  const pct = getXpPercent(u.xp||0);
  document.getElementById('prof-title').textContent = u.username;

  // Avatar + frame
  const container = document.getElementById('prof-avatar-container');
  const inner = document.getElementById('prof-avatar');
  if (u.photoURL) {
    inner.innerHTML = `<img src="${u.photoURL}" alt="avatar" crossorigin="anonymous" onerror="this.parentElement.textContent='${u.username[0].toUpperCase()}'">`;
  } else {
    inner.textContent = u.username[0].toUpperCase();
  }
  applyFrame(container, u.activeFrame);

  document.getElementById('prof-games').textContent = u.games||0;
  document.getElementById('prof-wins').textContent = u.wins||0;
  document.getElementById('prof-wr').textContent = (u.games||0)>0 ? Math.round((u.wins||0)/(u.games||1)*100)+'%' : '0%';
  document.getElementById('prof-level').textContent = `SEVƒ∞YE ${lv.level} ‚Äî ${lv.name}`;
  document.getElementById('prof-xp-txt').textContent = `${(u.xp||0).toLocaleString()} / ${lv.max===Infinity?'‚àû':lv.max.toLocaleString()} XP`;
  document.getElementById('prof-xp-bar').style.width = pct+'%';

  // Cosmetics info
  const ownedEffects = NAME_EFFECTS.filter(e=>(u.items||[]).includes(e.id));
  const ownedFrames = PROFILE_FRAMES.filter(f=>(u.items||[]).includes(f.id));
  const activeEff = ownedEffects.find(e=>e.id===u.activeNameEffect);
  const activeFr = ownedFrames.find(f=>f.id===u.activeFrame);
  let cosText = '';
  if (activeEff) cosText += `‚ú® Efekt: ${activeEff.name}  `;
  if (activeFr) cosText += `üñºÔ∏è √áer√ßeve: ${activeFr.name}`;
  if (!cosText) cosText = 'Aktif kozmetik yok';
  document.getElementById('prof-cosmetics').textContent = cosText;

  openModal('modal-profile');
}

// ‚îÄ‚îÄ‚îÄ Admin ‚îÄ‚îÄ‚îÄ
function openAdmin() {
  adminTab('coins');
  openModal('modal-admin');
  renderAdminUsers();
}

function adminTab(tab) {
  document.getElementById('adm-panel-coins').classList.toggle('hidden', tab !== 'coins');
  document.getElementById('adm-panel-questions').classList.toggle('hidden', tab !== 'questions');
  document.getElementById('adm-tab-coins').classList.toggle('active', tab === 'coins');
  document.getElementById('adm-tab-questions').classList.toggle('active', tab === 'questions');
  if (tab === 'questions') renderAdminList();
  if (tab === 'coins') renderAdminUsers();
}

let _adminUserUnsub = null;
async function renderAdminUsers() {
  const { db, collection, query, orderBy, onSnapshot } = window._FB;
  const el = document.getElementById('adm-user-list');
  el.innerHTML = '<div style="text-align:center;color:var(--text2);padding:20px">Y√ºkleniyor...</div>';
  if (_adminUserUnsub) { _adminUserUnsub(); _adminUserUnsub = null; }
  const q = query(collection(db, 'users'), orderBy('xp', 'desc'));
  _adminUserUnsub = onSnapshot(q, (snap) => {
    if (snap.empty) { el.innerHTML = '<div style="text-align:center;color:var(--text2);padding:20px">Hen√ºz kullanƒ±cƒ± yok.</div>'; return; }
    const myUid = window._currentUID;
    el.innerHTML = snap.docs.map(d => {
      const u = d.data(); const uid = d.id; const isMe = uid === myUid;
      return `<div style="display:flex;align-items:center;gap:10px;padding:12px;background:var(--glass);border:1px solid ${isMe?'rgba(0,195,255,0.3)':'var(--border)'};border-radius:12px;margin-bottom:8px;">
        <div style="width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--blue2),var(--purple2));display:flex;align-items:center;justify-content:center;font-weight:700;font-size:0.85rem;flex-shrink:0;overflow:hidden;">
          ${u.photoURL ? `<img src="${u.photoURL}" crossorigin="anonymous" style="width:100%;height:100%;object-fit:cover;border-radius:50%" onerror="this.style.display='none'">` : (u.username||'?')[0].toUpperCase()}
        </div>
        <div style="flex:1;min-width:0;">
          <div style="font-weight:700;font-size:0.88rem;color:${isMe?'var(--blue)':'var(--text)'};">${u.username||'?'}${isMe?' (sen)':''}</div>
          <div style="font-size:0.72rem;color:var(--text2);">üí∞ ${(u.coins||0).toLocaleString()} &nbsp;¬∑&nbsp; ‚≠ê ${(u.xp||0).toLocaleString()} XP &nbsp;¬∑&nbsp; üéÆ ${u.games||0} oyun</div>
        </div>
        <div style="display:flex;gap:6px;align-items:center;flex-shrink:0;">
          <input type="number" id="coin-input-${uid}" placeholder="Miktar" min="1" style="width:80px;padding:6px 8px;background:rgba(0,0,0,0.4);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:0.82rem;outline:none;">
          <button onclick="adminAddCoin('${uid}','${u.username||''}','${u.coins||0}')" style="padding:6px 12px;background:linear-gradient(135deg,var(--gold2),var(--gold));border:none;border-radius:8px;color:#000;font-weight:700;font-size:0.78rem;cursor:pointer;white-space:nowrap;">+ COIN</button>
        </div>
      </div>`;
    }).join('');
  });
}

async function adminAddCoin(uid, username, currentCoins) {
  const input = document.getElementById('coin-input-' + uid);
  const amount = parseInt(input?.value);
  if (!amount || amount <= 0) return toast('Ge√ßerli bir miktar girin!', 'error');
  const { db, doc, updateDoc } = window._FB;
  try {
    const newCoins = parseInt(currentCoins) + amount;
    await updateDoc(doc(db, 'users', uid), { coins: newCoins });
    if (uid === window._currentUID && window._userData) { window._userData.coins = newCoins; updateLobbyUI(); }
    if (input) input.value = '';
    toast(`‚úÖ ${username} hesabƒ±na ${amount.toLocaleString()} coin eklendi!`, 'gold');
  } catch(e) { toast('Hata: ' + e.message, 'error'); }
}

document.getElementById('modal-admin').addEventListener('click', (e) => {
  if (e.target === e.currentTarget) { if (_adminUserUnsub) { _adminUserUnsub(); _adminUserUnsub = null; } closeModal('modal-admin'); }
});

async function renderAdminList() {
  let qs = window._cachedQuestions || DEFAULT_QUESTIONS;
  const el = document.getElementById('adm-q-list');
  el.innerHTML = `<div class="section-title">Mevcut Sorular (${qs.length})</div>` +
    [...qs].reverse().slice(0,10).map(q => `
      <div class="admin-q-item">
        <span style="flex:1;color:var(--text2)">${(q.q||'').substring(0,40)}...</span>
        <span style="margin:0 8px;font-size:0.7rem;color:${q.diff==='easy'?'var(--green)':q.diff==='medium'?'var(--gold2)':'var(--red)'}">${q.diff}</span>
        ${q.id && typeof q.id === 'string' ? `<button class="btn-del" onclick="adminDelQ('${q.id}')">Sƒ∞L</button>` : ''}
      </div>`).join('');
}

async function adminAddQ() {
  const q = document.getElementById('adm-q').value.trim();
  const a = document.getElementById('adm-a').value.trim();
  const b = document.getElementById('adm-b').value.trim();
  const c = document.getElementById('adm-c').value.trim();
  const d = document.getElementById('adm-d').value.trim();
  const diff = document.getElementById('adm-diff').value;
  if (!q||!a||!b||!c||!d) return toast('T√ºm alanlarƒ± doldurun!','error');
  const { db, collection, addDoc, serverTimestamp } = window._FB;
  try {
    await addDoc(collection(db, 'questions'), { q, a:[a,b,c,d], correct:0, diff, createdAt: serverTimestamp() });
    toast('Soru eklendi!','success');
    ['adm-q','adm-a','adm-b','adm-c','adm-d'].forEach(id=>document.getElementById(id).value='');
    setTimeout(renderAdminList, 800);
  } catch(e) { toast('Hata: ' + e.message, 'error'); }
}

async function adminDelQ(id) {
  if (!id || typeof id !== 'string') return;
  const { db, doc, deleteDoc } = window._FB;
  try { await deleteDoc(doc(db, 'questions', id)); toast('Soru silindi.','info'); setTimeout(renderAdminList, 500); }
  catch(e) { toast('Hata: ' + e.message,'error'); }
}

// ‚îÄ‚îÄ‚îÄ DEFAULT QUESTIONS (450 adet - orijinal) ‚îÄ‚îÄ‚îÄ
const DEFAULT_QUESTIONS = [
{q:"T√ºrkiye'nin ba≈ükenti hangisidir?",a:["Ankara","ƒ∞stanbul","ƒ∞zmir","Bursa"],correct:0,diff:"easy"},
{q:"G√ºne≈ü sistemimizdeki en b√ºy√ºk gezegen hangisidir?",a:["Sat√ºrn","Nept√ºn","J√ºpiter","Uran√ºs"],correct:2,diff:"easy"},
{q:"Su'nun kimyasal form√ºl√º nedir?",a:["CO2","H2O","O2","NaCl"],correct:1,diff:"easy"},
{q:"En b√ºy√ºk okyanus hangisidir?",a:["Atlantik","Hint","Kuzey Buz","Pasifik"],correct:3,diff:"easy"},
{q:"Mona Lisa tablosunu kim yapmƒ±≈ütƒ±r?",a:["Michelangelo","Leonardo da Vinci","Picasso","Rembrandt"],correct:1,diff:"easy"},
{q:"Hangi hayvan 'Ormanƒ±n Kralƒ±' olarak bilinir?",a:["Kaplan","Aslan","Leopar","Panter"],correct:1,diff:"easy"},
{q:"Bir yƒ±lda ka√ß ay vardƒ±r?",a:["10","11","12","13"],correct:2,diff:"easy"},
{q:"Haftada ka√ß g√ºn vardƒ±r?",a:["5","6","7","8"],correct:2,diff:"easy"},
{q:"T√ºrkiye hangi kƒ±tada yer alƒ±r?",a:["Afrika","Asya/Avrupa","Okyanusya","Amerika"],correct:1,diff:"easy"},
{q:"G√∂kku≈üaƒüƒ±nda ka√ß renk vardƒ±r?",a:["5","6","7","8"],correct:2,diff:"easy"},
{q:"Hangi meyve sarƒ± renklidir ve maymunlarƒ±n favori meyvesidir?",a:["Elma","Portakal","Muz","√úz√ºm"],correct:2,diff:"easy"},
{q:"Bir saatte ka√ß dakika vardƒ±r?",a:["30","45","60","90"],correct:2,diff:"easy"},
{q:"T√ºrkiye'nin para birimi nedir?",a:["Euro","Dolar","Lira","Pound"],correct:2,diff:"easy"},
{q:"Hangi gezegen 'Kƒ±zƒ±l Gezegen' olarak bilinir?",a:["Ven√ºs","Mars","J√ºpiter","Sat√ºrn"],correct:1,diff:"easy"},
{q:"D√ºnyanƒ±n en uzun nehri hangisidir?",a:["Amazon","Nil","Yangtze","Mississippi"],correct:1,diff:"easy"},
{q:"Hangi hayvan en yava≈ü hareket ettiƒüiyle bilinir?",a:["Kaplumbaƒüa","Tembel Hayvan","Salyangoz","Balƒ±k"],correct:1,diff:"easy"},
{q:"Futbolda bir takƒ±mda ka√ß oyuncu bulunur?",a:["9","10","11","12"],correct:2,diff:"easy"},
{q:"Hangi √ºlke Eyfel Kulesi'ne ev sahipliƒüi yapar?",a:["ƒ∞talya","ƒ∞spanya","Fransa","Almanya"],correct:2,diff:"easy"},
{q:"ƒ∞nsan v√ºcudunda ka√ß g√∂z vardƒ±r?",a:["1","2","3","4"],correct:1,diff:"easy"},
{q:"Hangi renk g√ºne≈üi simgeler?",a:["Mavi","Ye≈üil","Sarƒ±","Kƒ±rmƒ±zƒ±"],correct:2,diff:"easy"},
{q:"Ekmek hangi undan yapƒ±lƒ±r?",a:["Mƒ±sƒ±r","Pirin√ß","Buƒüday","Arpa"],correct:2,diff:"easy"},
{q:"D√ºnya'nƒ±n uydusu nedir?",a:["Mars","Ay","G√ºne≈ü","Ven√ºs"],correct:1,diff:"easy"},
{q:"Hangi mevsimde kar yaƒüar?",a:["ƒ∞lkbahar","Yaz","Sonbahar","Kƒ±≈ü"],correct:3,diff:"easy"},
{q:"T√ºrkiye'nin en b√ºy√ºk ≈üehri hangisidir?",a:["Ankara","ƒ∞zmir","ƒ∞stanbul","Bursa"],correct:2,diff:"easy"},
{q:"Hangi hayvan '√á√∂l Gemisi' olarak bilinir?",a:["At","Fil","Deve","Z√ºrafa"],correct:2,diff:"easy"},
{q:"Bir dakikada ka√ß saniye vardƒ±r?",a:["30","60","90","120"],correct:1,diff:"easy"},
{q:"Hangi sporda raket kullanƒ±lƒ±r?",a:["Futbol","Tenis","Basketbol","Y√ºzme"],correct:1,diff:"easy"},
{q:"Hangi √ºlkenin ba≈ükenti Roma'dƒ±r?",a:["ƒ∞spanya","Portekiz","ƒ∞talya","Yunanistan"],correct:2,diff:"easy"},
{q:"Suyun donma noktasƒ± ka√ß derecedir?",a:["-10¬∞C","0¬∞C","10¬∞C","100¬∞C"],correct:1,diff:"easy"},
{q:"Hangi renk g√∂ky√ºz√ºn√ºn rengidir?",a:["Ye≈üil","Sarƒ±","Mavi","Mor"],correct:2,diff:"easy"},
{q:"Portakal hangi vitaminle zengindir?",a:["A","B","C","D"],correct:2,diff:"easy"},
{q:"D√ºnyanƒ±n en b√ºy√ºk √ß√∂l√º hangisidir?",a:["Gobi","Kalahari","Arabistan","Sahra"],correct:3,diff:"easy"},
{q:"ƒ∞stanbul Boƒüazƒ± hangi iki denizi birle≈ütirir?",a:["Karadeniz - Akdeniz","Karadeniz - Marmara","Ege - Akdeniz","Adriyatik - Ege"],correct:1,diff:"easy"},
{q:"Hangi hayvan u√ßar ama ku≈ü deƒüildir?",a:["Penguen","Yarasa","Deveku≈üu","Tavuk"],correct:1,diff:"easy"},
{q:"Bir yƒ±lda ka√ß hafta vardƒ±r?",a:["48","50","52","54"],correct:2,diff:"easy"},
{q:"Hangi element en hafiftir?",a:["Helyum","Hidrojen","Lityum","Karbon"],correct:1,diff:"easy"},
{q:"Hangi organda kan pompalanƒ±r?",a:["Karaciƒüer","B√∂brek","Kalp","Akciƒüer"],correct:2,diff:"easy"},
{q:"D√ºnyanƒ±n en y√ºksek daƒüƒ± hangisidir?",a:["K2","Everest","Kilimanjaro","Mont Blanc"],correct:1,diff:"easy"},
{q:"Hangi √ºlke piramitlerle √ºnl√ºd√ºr?",a:["Irak","Meksika","Mƒ±sƒ±r","ƒ∞ran"],correct:2,diff:"easy"},
{q:"T√ºrkiye'nin ka√ß ili vardƒ±r?",a:["71","79","81","85"],correct:2,diff:"easy"},
{q:"Hangi element havada en bol bulunur?",a:["Oksijen","Argon","Karbon","Azot"],correct:3,diff:"easy"},
{q:"Hangi √ºlkenin ba≈ükenti Tokyo'dur?",a:["√áin","Kore","Japonya","Vietnam"],correct:2,diff:"easy"},
{q:"Hangi √ºlkede kangaroo ya≈üar?",a:["Yeni Zelanda","Brezilya","Avustralya","Afrika"],correct:2,diff:"easy"},
{q:"D√ºnya'nƒ±n en b√ºy√ºk kƒ±tasƒ± hangisidir?",a:["Afrika","Amerika","Avrupa","Asya"],correct:3,diff:"easy"},
{q:"Hangi hayvan aƒü √∂rer?",a:["Arƒ±","Karƒ±nca","√ñr√ºmcek","Sinek"],correct:2,diff:"easy"},
{q:"Hangi organda sindirim ba≈ülar?",a:["Mide","Baƒüƒ±rsak","Aƒüƒ±z","Karaciƒüer"],correct:2,diff:"easy"},
{q:"Bir g√ºnde ka√ß saat vardƒ±r?",a:["12","20","24","36"],correct:2,diff:"easy"},
{q:"Hangi hayvan en b√ºy√ºk kara hayvanƒ±dƒ±r?",a:["Z√ºrafa","Gergedan","Fil","Aslan"],correct:2,diff:"easy"},
{q:"T√ºrkiye'nin g√ºney kƒ±yƒ±sƒ±nƒ± hangi deniz yƒ±kar?",a:["Karadeniz","Ege","Marmara","Akdeniz"],correct:3,diff:"easy"},
{q:"Bir yƒ±lda ka√ß g√ºn vardƒ±r?",a:["350","360","365","370"],correct:2,diff:"easy"},
{q:"Hangi √ºlkenin ba≈ükenti Paris'tir?",a:["Bel√ßika","ƒ∞svi√ßre","Fransa","Hollanda"],correct:2,diff:"easy"},
{q:"Hangi √ºlkenin ba≈ükenti Berlin'dir?",a:["Avusturya","Hollanda","ƒ∞svi√ßre","Almanya"],correct:3,diff:"easy"},
{q:"Hangi √ºlkede Kolosseum bulunur?",a:["Yunanistan","ƒ∞talya","ƒ∞spanya","T√ºrkiye"],correct:1,diff:"easy"},
{q:"Hangi √ºlkede Taj Mahal bulunur?",a:["Pakistan","Banglade≈ü","Hindistan","Nepal"],correct:2,diff:"easy"},
{q:"Hangi √ºlkede Big Ben kulesi bulunur?",a:["Fransa","ABD","ƒ∞ngiltere","Almanya"],correct:2,diff:"easy"},
{q:"Hangi √ºlkenin ba≈ükenti Madrid'dir?",a:["Portekiz","Fransa","ƒ∞spanya","ƒ∞talya"],correct:2,diff:"easy"},
{q:"Hangi √ºlkede B√ºy√ºk Duvar bulunur?",a:["Japonya","Hindistan","√áin","Kore"],correct:2,diff:"easy"},
{q:"Hangi element periyodik tabloda 'Au' sembol√º ile g√∂sterilir?",a:["G√ºm√º≈ü","Demir","Altƒ±n","Bakƒ±r"],correct:2,diff:"medium"},
{q:"Osmanlƒ± ƒ∞mparatorluƒüu hangi yƒ±lda kurulmu≈ütur?",a:["1299","1453","1071","1389"],correct:0,diff:"medium"},
{q:"Pi sayƒ±sƒ±nƒ±n ilk 3 basamaƒüƒ± nedir?",a:["3.14","3.16","3.12","3.18"],correct:0,diff:"medium"},
{q:"ƒ∞nsan v√ºcudunda ka√ß kemik bulunur?",a:["196","206","216","186"],correct:1,diff:"medium"},
{q:"Hangi √ºlke 2022 FIFA D√ºnya Kupasƒ±'nƒ± kazandƒ±?",a:["Fransa","Brezilya","Arjantin","Hƒ±rvatistan"],correct:2,diff:"medium"},
{q:"DNA'nƒ±n a√ßƒ±lƒ±mƒ± nedir?",a:["Dioksiribon√ºkleik Asit","Dinitrojen Asit","Dikarbonokleik Asit","Difosfor Asit"],correct:0,diff:"medium"},
{q:"I≈üƒ±ƒüƒ±n hƒ±zƒ± saniyede ka√ß km'dir?",a:["200.000","299.792","350.000","150.000"],correct:1,diff:"medium"},
{q:"Hangi element periyodik tabloda 'Fe' sembol√º ile g√∂sterilir?",a:["Flor","Fosfor","Demir","Fermiyum"],correct:2,diff:"medium"},
{q:"Hangi √ºlkede Nobel √ñd√ºlleri verilir?",a:["Danimarka","ƒ∞sve√ß","Norve√ß","Finlandiya"],correct:1,diff:"medium"},
{q:"Osmanlƒ± ƒ∞mparatorluƒüu hangi yƒ±lda sona ermi≈ütir?",a:["1920","1922","1923","1924"],correct:1,diff:"medium"},
{q:"Hangi bilim insanƒ± izafiyet teorisini geli≈ütirmi≈ütir?",a:["Newton","Bohr","Einstein","Planck"],correct:2,diff:"medium"},
{q:"Hangi organ ins√ºlin √ºretir?",a:["Karaciƒüer","B√∂brek","Pankreas","Dalak"],correct:2,diff:"medium"},
{q:"T√ºrkiye Cumhuriyeti hangi yƒ±lda kurulmu≈ütur?",a:["1919","1920","1921","1923"],correct:3,diff:"medium"},
{q:"Hangi bilim insanƒ± yer√ßekimi yasasƒ±nƒ± form√ºle etmi≈ütir?",a:["Galileo","Copernicus","Newton","Kepler"],correct:2,diff:"medium"},
{q:"Hangi sava≈ü 1914-1918 yƒ±llarƒ± arasƒ±nda ya≈üandƒ±?",a:["Napolyon Sava≈ülarƒ±","1. D√ºnya Sava≈üƒ±","2. D√ºnya Sava≈üƒ±","Soƒüuk Sava≈ü"],correct:1,diff:"medium"},
{q:"Hangi √ºlkede Amazon Nehri'nin b√ºy√ºk b√∂l√ºm√º akar?",a:["Kolombiya","Peru","Venezuela","Brezilya"],correct:3,diff:"medium"},
{q:"Hangi bilim insanƒ± ampul√º icat etmi≈ütir?",a:["Tesla","Faraday","Edison","Bell"],correct:2,diff:"medium"},
{q:"Hangi element periyodik tabloda 'Ag' sembol√º ile g√∂sterilir?",a:["Altƒ±n","G√ºm√º≈ü","Baryum","Arsenik"],correct:1,diff:"medium"},
{q:"Hangi bilim insanƒ± evrim teorisini geli≈ütirmi≈ütir?",a:["Mendel","Lamarck","Darwin","Wallace"],correct:2,diff:"medium"},
{q:"Hangi √ºlke 2018 FIFA D√ºnya Kupasƒ±'nƒ± kazandƒ±?",a:["Almanya","Fransa","Brezilya","Arjantin"],correct:1,diff:"medium"},
{q:"Hangi organ safra √ºretir?",a:["Pankreas","Dalak","B√∂brek","Karaciƒüer"],correct:3,diff:"medium"},
{q:"Hangi bilim insanƒ± penicilini ke≈üfetmi≈ütir?",a:["Pasteur","Lister","Fleming","Koch"],correct:2,diff:"medium"},
{q:"Hangi √ºlke 2014 FIFA D√ºnya Kupasƒ±'nƒ± kazandƒ±?",a:["Brezilya","Arjantin","Fransa","Almanya"],correct:3,diff:"medium"},
{q:"Hangi bilim insanƒ± radyumu ke≈üfetmi≈ütir?",a:["Einstein","R√∂ntgen","Marie Curie","Bohr"],correct:2,diff:"medium"},
{q:"Hangi √ºlke 2010 FIFA D√ºnya Kupasƒ±'nƒ± kazandƒ±?",a:["Almanya","Brezilya","ƒ∞spanya","Arjantin"],correct:2,diff:"medium"},
{q:"Hangi organ oksijeni kana karƒ±≈ütƒ±rƒ±r?",a:["Kalp","B√∂brek","Karaciƒüer","Akciƒüer"],correct:3,diff:"medium"},
{q:"Hangi √ºlkede Angkor Wat tapƒ±naƒüƒ± bulunur?",a:["Tayland","Vietnam","Kambo√ßya","Myanmar"],correct:2,diff:"medium"},
{q:"Hangi bilim insanƒ± X-ƒ±≈üƒ±nlarƒ±nƒ± ke≈üfetmi≈ütir?",a:["Curie","Becquerel","R√∂ntgen","Thomson"],correct:2,diff:"medium"},
{q:"Hangi √ºlke 2006 FIFA D√ºnya Kupasƒ±'nƒ± kazandƒ±?",a:["Fransa","Almanya","ƒ∞talya","Portekiz"],correct:2,diff:"medium"},
{q:"Hangi √ºlkede Machu Picchu bulunur?",a:["Bolivya","Kolombiya","Peru","≈ûili"],correct:2,diff:"medium"},
{q:"Hangi bilim insanƒ± polio a≈üƒ±sƒ±nƒ± geli≈ütirmi≈ütir?",a:["Pasteur","Salk","Sabin","Jenner"],correct:1,diff:"medium"},
{q:"Hangi √ºlke 2002 FIFA D√ºnya Kupasƒ±'nƒ± kazandƒ±?",a:["Arjantin","ƒ∞talya","Fransa","Brezilya"],correct:3,diff:"medium"},
{q:"Hangi √ºlkede Chichen Itza bulunur?",a:["Guatemala","Meksika","Honduras","Belize"],correct:1,diff:"medium"},
{q:"Hangi bilim insanƒ± dinamiti icat etmi≈ütir?",a:["Pasteur","Nobel","Faraday","Edison"],correct:1,diff:"medium"},
{q:"Hangi √ºlke 1990 FIFA D√ºnya Kupasƒ±'nƒ± kazandƒ±?",a:["Arjantin","Brezilya","Batƒ± Almanya","ƒ∞talya"],correct:2,diff:"medium"},
{q:"Hangi √ºlkede Persepolis harabalarƒ± bulunur?",a:["Irak","Suriye","ƒ∞ran","T√ºrkiye"],correct:2,diff:"medium"},
{q:"Hangi bilim insanƒ± elektrik motorunu geli≈ütirmi≈ütir?",a:["Faraday","Edison","Tesla","Hertz"],correct:2,diff:"medium"},
{q:"Hangi √ºlke 1986 FIFA D√ºnya Kupasƒ±'nƒ± kazandƒ±?",a:["Brezilya","ƒ∞talya","Almanya","Arjantin"],correct:3,diff:"medium"},
{q:"Hangi √ºlkede Topkapƒ± Sarayƒ± bulunur?",a:["ƒ∞ran","Mƒ±sƒ±r","T√ºrkiye","Yunanistan"],correct:2,diff:"medium"},
{q:"Hangi bilim insanƒ± gramofonu icat etmi≈ütir?",a:["Bell","Edison","Tesla","Marconi"],correct:1,diff:"medium"},
{q:"Hangi √ºlke 1982 FIFA D√ºnya Kupasƒ±'nƒ± kazandƒ±?",a:["Brezilya","Fransa","Almanya","ƒ∞talya"],correct:3,diff:"medium"},
{q:"Hangi √ºlkede Petra ≈üehri bulunur?",a:["Suriye","ƒ∞srail","Irak","√úrd√ºn"],correct:3,diff:"medium"},
{q:"Hangi bilim insanƒ± miktrop teorisini a√ßƒ±kladƒ±?",a:["Koch","Pasteur","Leeuwenhoek","Jenner"],correct:2,diff:"medium"},
{q:"Hangi √ºlke 1978 FIFA D√ºnya Kupasƒ±'nƒ± kazandƒ±?",a:["Brezilya","Hollanda","Almanya","Arjantin"],correct:3,diff:"medium"},
{q:"Hangi √ºlkede Vatican City bulunur?",a:["ƒ∞spanya","Yunanistan","ƒ∞talya","Fransa"],correct:2,diff:"medium"},
{q:"Hangi bilim insanƒ± √ßi√ßek hastalƒ±ƒüƒ± a≈üƒ±sƒ±nƒ± geli≈ütirmi≈ütir?",a:["Pasteur","Lister","Jenner","Fleming"],correct:2,diff:"medium"},
{q:"Hangi √ºlke 1974 FIFA D√ºnya Kupasƒ±'nƒ± kazandƒ±?",a:["Brezilya","Hollanda","ƒ∞talya","Batƒ± Almanya"],correct:3,diff:"medium"},
{q:"Hangi bilim insanƒ± kanƒ±n dola≈üƒ±mƒ±nƒ± ke≈üfetmi≈ütir?",a:["Galen","Harvey","Vesalius","Hippocrates"],correct:1,diff:"medium"},
{q:"Hangi √ºlke en fazla Nobel √ñd√ºl√º kazanmƒ±≈ütƒ±r?",a:["ƒ∞ngiltere","Fransa","Almanya","ABD"],correct:3,diff:"medium"},
{q:"Hangi √ºlke 1966 FIFA D√ºnya Kupasƒ±'nƒ± kazandƒ±?",a:["Almanya","Portekiz","ƒ∞ngiltere","Brezilya"],correct:2,diff:"medium"},
{q:"Hangi √ºlkede Hagia Sophia bulunur?",a:["Yunanistan","Rusya","ƒ∞ran","T√ºrkiye"],correct:3,diff:"medium"},
{q:"Hangi √ºlke 1962 FIFA D√ºnya Kupasƒ±'nƒ± kazandƒ±?",a:["Arjantin","Brezilya","≈ûili","Uruguay"],correct:1,diff:"medium"},
{q:"Hangi √ºlke 1958 FIFA D√ºnya Kupasƒ±'nƒ± kazandƒ±?",a:["ƒ∞sve√ß","Fransa","Uruguay","Brezilya"],correct:3,diff:"medium"},
{q:"Hangi √ºlke 1954 FIFA D√ºnya Kupasƒ±'nƒ± kazandƒ±?",a:["ƒ∞talya","Macaristan","Brezilya","Batƒ± Almanya"],correct:3,diff:"medium"},
{q:"Hangi √ºlke 1950 FIFA D√ºnya Kupasƒ±'nƒ± kazandƒ±?",a:["Brezilya","ƒ∞ngiltere","Uruguay","Arjantin"],correct:2,diff:"medium"},
{q:"Hangi √ºlke ilk d√ºnya kupasƒ±nƒ± kazandƒ± (1930)?",a:["Arjantin","Brezilya","Uruguay","ABD"],correct:2,diff:"medium"},
// HARD
{q:"Higgs Bozonu hangi yƒ±lda deneysel olarak doƒürulandƒ±?",a:["2010","2012","2014","2008"],correct:1,diff:"hard"},
{q:"Fibonacci dizisinde 144'ten sonra gelen sayƒ± nedir?",a:["233","221","256","200"],correct:0,diff:"hard"},
{q:"ƒ∞lk bilgisayar programcƒ±sƒ± olarak kabul edilen ki≈üi kimdir?",a:["Alan Turing","Ada Lovelace","Charles Babbage","Grace Hopper"],correct:1,diff:"hard"},
{q:"Evrenin tahmini ya≈üƒ± ka√ß yƒ±ldƒ±r?",a:["9.8 milyar","13.8 milyar","18.5 milyar","7.2 milyar"],correct:1,diff:"hard"},
{q:"Fermat'ƒ±n Son Teoremi'ni kanƒ±tlayan matematik√ßi kimdir?",a:["Carl Gauss","Andrew Wiles","Leonhard Euler","Srinivasa Ramanujan"],correct:1,diff:"hard"},
{q:"DNA'nƒ±n √ßift sarmal yapƒ±sƒ±nƒ± ke≈üfeden bilim insanlarƒ± kimlerdir?",a:["Curie ve Becquerel","Watson ve Crick","Mendel ve Morgan","Darwin ve Wallace"],correct:1,diff:"hard"},
{q:"Kuantum bilgisayarlarda kullanƒ±lan temel birim nedir?",a:["Bit","Bayt","Qubit","Nibble"],correct:2,diff:"hard"},
{q:"Kara delikler ilk olarak hangi bilim insanƒ±nƒ±n √ßalƒ±≈ümalarƒ±yla teorik olarak √∂ng√∂r√ºld√º?",a:["Hawking","Einstein","Schwarzschild","Penrose"],correct:2,diff:"hard"},
{q:"CRISPR-Cas9 teknolojisi neyi m√ºmk√ºn kƒ±lmaktadƒ±r?",a:["Protein sentezi","Gen d√ºzenleme","RNA sentezi","H√ºcre b√∂l√ºnmesi"],correct:1,diff:"hard"},
{q:"Hangi matematik√ßi 'ƒ∞nkompletness Teoremi'ni kanƒ±tlamƒ±≈ütƒ±r?",a:["Hilbert","Turing","G√∂del","Cantor"],correct:2,diff:"hard"},
{q:"Hangi fizik deneyi ƒ±≈üƒ±ƒüƒ±n dalga ve par√ßacƒ±k √∂zelliƒüini g√∂sterir?",a:["Compton Sa√ßƒ±lmasƒ±","Fotoelektrik Etki","√áift Yarƒ±k Deneyi","Michelson-Morley"],correct:2,diff:"hard"},
{q:"Euler'in kimlik form√ºl√º (e^iœÄ + 1 = 0) hangi sayƒ±larƒ± i√ßerir?",a:["e, i, œÄ, 0, 1","e, i, œÄ, 2, 1","e, i, œÄ, 0, 2","‚àö2, i, œÄ, 0, 1"],correct:0,diff:"hard"},
{q:"Nash Dengesi hangi alanda kullanƒ±lƒ±r?",a:["Fizik","Oyun teorisi","Kimya","Biyoloji"],correct:1,diff:"hard"},
{q:"Holografik prensip neyi √∂ne s√ºrer?",a:["Evrenin 3 boyutlu olduƒüunu","Evrenin 2 boyutlu y√ºzey √ºzerinde kodlandƒ±ƒüƒ±nƒ±","Karadeliklerin sonsuz yoƒüunlukta olduƒüunu","Zaman yolculuƒüunun m√ºmk√ºn olduƒüunu"],correct:1,diff:"hard"},
{q:"Protein katlama problemi hangi alanda kritik √∂neme sahiptir?",a:["Fizik","Astronomi","Biyoinformatik","Kimya m√ºhendisliƒüi"],correct:2,diff:"hard"},
{q:"Heisenberg Belirsizlik ƒ∞lkesi nedir?",a:["Bir par√ßacƒ±ƒüƒ±n konumu ve momentumu aynƒ± anda tam olarak bilinemez","I≈üƒ±k hƒ±zƒ± a≈üƒ±lamaz","Enerji korunur","Entropi her zaman artar"],correct:0,diff:"hard"},
{q:"Hangi element 93. atom numarasƒ±na sahiptir?",a:["Uranyum","Pl√ºtonyum","Nept√ºnyum","Amerikaniyum"],correct:2,diff:"hard"},
{q:"Mandelbrot K√ºmesi hangi matematiksel yapƒ±yla ilgilidir?",a:["Topoloji","Fraktallar","Sayƒ± Teorisi","Cebir"],correct:1,diff:"hard"},
{q:"Hangi biyolojik s√ºre√ß ATP √ºretimini ger√ßekle≈ütirir?",a:["Glikoliz","Krebs D√∂ng√ºs√º","Oksidatif Fosforilasyon","Fotosentez"],correct:2,diff:"hard"},
{q:"Navier-Stokes denklemleri neyi a√ßƒ±klar?",a:["Elektromanyetizma","Termodinamik","Akƒ±≈ükan dinamiƒüi","Kuantum mekaniƒüi"],correct:2,diff:"hard"},
{q:"Hangi bilim insanƒ± 'Kara delikler buharla≈üƒ±r' teorisini √∂ne s√ºrm√º≈üt√ºr?",a:["Penrose","Hawking","Thorne","Wheeler"],correct:1,diff:"hard"},
{q:"Langlands Programƒ± hangi iki alanƒ± birle≈ütirmeye √ßalƒ±≈üƒ±r?",a:["Fizik ve kimya","Geometri ve sayƒ± teorisi","Biyoloji ve matematik","Astronomi ve fizik"],correct:1,diff:"hard"},
{q:"Shor Algoritmasƒ± neyi √ß√∂zmede kullanƒ±lƒ±r?",a:["Sƒ±ralama problemleri","B√ºy√ºk sayƒ±larƒ±n asal √ßarpanlarƒ±na ayrƒ±lmasƒ±","Optimizasyon problemleri","Veritabanƒ± arama"],correct:1,diff:"hard"},
{q:"Kaotik sistemlerin temel √∂zelliƒüi nedir?",a:["Tahmin edilebilirlik","Ba≈ülangƒ±√ß ko≈üullarƒ±na a≈üƒ±rƒ± duyarlƒ±lƒ±k","D√ºzenli periyodik davranƒ±≈ü","Enerji korunumu"],correct:1,diff:"hard"},
{q:"Hangi molek√ºl enerji para birimi olarak kullanƒ±lƒ±r?",a:["ADP","NAD+","ATP","FADH2"],correct:2,diff:"hard"},
{q:"Hangi fizik teorisi uzay-zamanƒ±n eƒüriliƒüini a√ßƒ±klar?",a:["√ñzel G√∂relilik","Kuantum Mekaniƒüi","Genel G√∂relilik","Termodinamik"],correct:2,diff:"hard"},
{q:"Hangi par√ßacƒ±k 'Tanrƒ± Par√ßacƒ±ƒüƒ±' olarak bilinir?",a:["Kuark","Graviton","Higgs Bozonu","N√∂trino"],correct:2,diff:"hard"},
{q:"Hangi matematik dalƒ± s√ºrekli d√∂n√º≈ü√ºmleri inceler?",a:["Cebir","Aritmetik","Topoloji","ƒ∞statistik"],correct:2,diff:"hard"},
{q:"Epigenetik nedir?",a:["DNA dizisini deƒüi≈ütirmeden gen ifadesindeki deƒüi≈üiklikler","DNA'nƒ±n fiziksel yapƒ±sƒ±","RNA sentezinin mekanizmasƒ±","Protein katlanma s√ºreci"],correct:0,diff:"hard"},
{q:"Olasƒ±lƒ±k teorisinde Bayes Teoremi neyi a√ßƒ±klar?",a:["Baƒüƒ±msƒ±z olaylarƒ±","Ko≈üullu olasƒ±lƒ±ƒüƒ±","Normal daƒüƒ±lƒ±mƒ±","Merkezi limit teoremini"],correct:1,diff:"hard"},
{q:"Hangi biyolojik s√ºre√ß telomerlerin kƒ±salmasƒ±yla ili≈ükilidir?",a:["Kanser","H√ºcre b√∂l√ºnmesi","Ya≈ülanma","Apoptoz"],correct:2,diff:"hard"},
{q:"Goldbach Konjekt√ºr√º neyi √∂ne s√ºrer?",a:["Her √ßift sayƒ± iki asal sayƒ±nƒ±n toplamƒ±dƒ±r","Her tek sayƒ± √º√ß asal sayƒ±nƒ±n toplamƒ±dƒ±r","Sonsuz sayƒ±da asal sayƒ± vardƒ±r","Asal sayƒ±lar log daƒüƒ±lƒ±mƒ± izler"],correct:0,diff:"hard"},
{q:"Hangi fizik kanunu 'entropi her zaman artar'ƒ± ifade eder?",a:["Termodinamik 1. Yasa","Termodinamik 2. Yasa","Termodinamik 3. Yasa","Termodinamik 0. Yasa"],correct:1,diff:"hard"},
{q:"Hangi teori hem kuantum mekaniƒüini hem de √∂zel g√∂reliliƒüi birle≈ütirir?",a:["Sicim Teorisi","Kuantum Alan Teorisi","Genel G√∂relilik","M-Teorisi"],correct:1,diff:"hard"},
{q:"Hangi biyolojik molek√ºl ribozomda sentezlenir?",a:["DNA","RNA","Protein","Lipid"],correct:2,diff:"hard"},
{q:"Hangi konsept 'hesaplanamaz problem'i tanƒ±mlar?",a:["NP-hard problem","Halting problem","P problemi","NP-complete problem"],correct:1,diff:"hard"},
{q:"Hangi kuantum √∂zelliƒüi teleportasyona olanak tanƒ±r?",a:["S√ºperpozisyon","T√ºnel etkisi","Kuantum dolanƒ±klƒ±ƒüƒ±","Decoherence"],correct:2,diff:"hard"},
{q:"Hangi h√ºcresel s√ºre√ß otofaji olarak bilinir?",a:["H√ºcrenin kendi bile≈üenlerini sindirmesi","H√ºcre b√∂l√ºnmesi","Programlƒ± h√ºcre √∂l√ºm√º","Protein sentezi"],correct:0,diff:"hard"},
{q:"Hangi fiziksel kavram 'ƒ±≈üƒ±ƒüƒ±n yer√ßekimi tarafƒ±ndan b√ºk√ºld√ºƒü√º'n√º a√ßƒ±klar?",a:["√ñzel G√∂relilik","Genel G√∂relilik","Kuantum Mekaniƒüi","Elektromanyetizma"],correct:1,diff:"hard"},
{q:"Hangi kuantum bilgisayar algoritmasƒ± veritabanƒ± aramasƒ±nƒ± hƒ±zlandƒ±rƒ±r?",a:["Shor Algoritmasƒ±","Grover Algoritmasƒ±","Deutsch Algoritmasƒ±","Simon Algoritmasƒ±"],correct:1,diff:"hard"},
];

// ‚îÄ‚îÄ‚îÄ Game State ‚îÄ‚îÄ‚îÄ
let G = {
  questions:[], current:0, answers:0,
  xpEarned:0, coinEarned:0, prizeTotal:0,
  jokers:{fifty:false,audience:false,phone:false,double:false},
  doubleSelected:[], doubleMode:false,
  timerInterval:null, timerSec:30, timerMax:30,
  inputLocked:true, barrierPassed:-1, xpBoostActive:false
};

function getGameQuestions() {
  const firebaseQs = (window._cachedQuestions && window._cachedQuestions.length > 0)
    ? window._cachedQuestions.filter(q => q.q && q.a && q.a.length === 4 && typeof q.correct === 'number' && q.diff)
    : [];
  const all = [...DEFAULT_QUESTIONS, ...firebaseQs];
  const easy = shuffle(all.filter(q=>q.diff==='easy'));
  const medium = shuffle(all.filter(q=>q.diff==='medium'));
  const hard = shuffle(all.filter(q=>q.diff==='hard'));
  const result = [...easy.slice(0,5),...medium.slice(0,5),...hard.slice(0,5)];
  while (result.length < 15) {
    const pool = [...easy,...medium,...hard];
    if(pool.length===0) break;
    result.push(pool[result.length % pool.length]);
  }
  return result.slice(0,15).map(q=>{
    const correct = q.a[q.correct];
    const shuffled = shuffle([...q.a]);
    return {...q, a:shuffled, correct:shuffled.indexOf(correct)};
  });
}

function shuffle(arr) {
  const a=[...arr];
  for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}
  return a;
}

async function startGame() {
  closeModal('modal-gameover');
  BGM.init(); TTS.init();
  const u = window._userData;
  if (!u) return;
  G.xpBoostActive = isXpBoostActive();
  G.questions = getGameQuestions();
  G.current=0; G.answers=0; G.xpEarned=0; G.coinEarned=0; G.prizeTotal=0;
  G.jokers={fifty:false,audience:false,phone:false,double:false};
  G.doubleSelected=[]; G.doubleMode=false;
  G.barrierPassed=-1; G.inputLocked=true;
  clearTimer();
  showScreen('game');
  document.getElementById('g-qnum').textContent='1/15';
  document.getElementById('g-xp').textContent='+0';
  document.getElementById('audience-result').innerHTML='';
  document.getElementById('phone-result').innerHTML='';
  resetJokerButtons();
  renderBarriers();
  BGM.play();

  // XP Boost indicator in game
  const gameStatus = document.getElementById('game-status');
  if (G.xpBoostActive) {
    gameStatus.innerHTML = '<span class="xpboost-indicator">‚ö° 2x XP AKTƒ∞F</span>';
  } else {
    gameStatus.textContent = 'Oyun ba≈üladƒ±!';
  }

  await delay(400);
  await loadQuestion();
}

async function loadQuestion() {
  if (G.current >= G.questions.length) { await endGame(true); return; }
  const q = G.questions[G.current];
  const qi = G.current;
  document.getElementById('q-num-label').textContent=`SORU ${qi+1}`;
  document.getElementById('g-qnum').textContent=`${qi+1}/15`;
  document.getElementById('q-diff-badge').textContent=q.diff==='easy'?'KOLAY':q.diff==='medium'?'ORTA':'ZOR';
  document.getElementById('q-diff-badge').className=`q-diff ${q.diff}`;
  document.getElementById('q-text').textContent=q.q;
  document.getElementById('g-prize').textContent=PRIZE_TABLE[qi].toLocaleString()+' ‚Ç∫';
  document.getElementById('audience-result').innerHTML='';
  document.getElementById('phone-result').innerHTML='';
  G.doubleSelected=[]; G.doubleMode=false;
  renderAnswers(q.a,-1,-1);
  renderBarriers();
  updateJokerBtns();
  const noTimer = qi > BARRIERS[1];
  document.getElementById('timer-lbl').textContent=noTimer?'S√úRE YOK':'S√úRE';
  if (noTimer) {
    document.getElementById('timer-circle').style.cssText='--pct:100%';
    document.getElementById('timer-num').textContent='‚àû';
    document.getElementById('timer-circle').classList.remove('danger');
  } else {
    const sec=qi<5?30:qi<10?25:20;
    G.timerMax=sec; startTimer(sec);
  }
  await TTS.readQuestion(q.q, q.a);
}

function renderAnswers(answers, correctIdx, wrongIdx) {
  const letters=['A','B','C','D'];
  document.getElementById('answers-grid').innerHTML = answers.map((ans,i)=>{
    let cls='';
    if(correctIdx>=0&&i===correctIdx)cls='correct';
    else if(wrongIdx>=0&&i===wrongIdx)cls='wrong';
    if(G.doubleSelected.includes(i)&&cls==='')cls='double-selected';
    return `<button class="answer-btn ${cls}" data-idx="${i}" onclick="pickAnswer(${i})" ${G.inputLocked?'disabled':''}>
      <div class="answer-letter">${letters[i]}</div>
      <span style="color:#ffffff">${ans}</span>
    </button>`;
  }).join('');
}

function updateAnswerState() {
  document.querySelectorAll('.answer-btn').forEach(b=>{ b.disabled=G.inputLocked; });
}

async function pickAnswer(idx) {
  if (G.inputLocked) return;

  // Double joker mode
  if (G.doubleMode) {
    if (G.doubleSelected.includes(idx)) {
      G.doubleSelected = G.doubleSelected.filter(i=>i!==idx);
      renderAnswers(G.questions[G.current].a, -1, -1);
      return;
    }
    if (G.doubleSelected.length < 2) {
      G.doubleSelected.push(idx);
      renderAnswers(G.questions[G.current].a, -1, -1);
    }
    if (G.doubleSelected.length === 2) {
      // Auto-submit double
      await submitDoubleAnswer();
    }
    return;
  }

  G.inputLocked=true; clearTimer();
  const q=G.questions[G.current];
  const correct=q.correct;
  const isCorrect=idx===correct;
  renderAnswers(q.a, correct, isCorrect?-1:idx);
  if (isCorrect) {
    BGM.correct();
    const xp=XP_TABLE[G.current]*(G.xpBoostActive?2:1);
    const coin=COIN_TABLE[G.current];
    G.xpEarned+=xp; G.coinEarned+=coin; G.prizeTotal=PRIZE_TABLE[G.current]; G.answers++;
    if (BARRIERS.includes(G.current)) G.barrierPassed=G.current;
    document.getElementById('g-xp').textContent=`+${G.xpEarned}`;
    showEffect(`‚úì +${xp} XP`,'correct-color');
    await TTS.sayCorrect();
    G.current++;
    await delay(600);
    await loadQuestion();
  } else {
    BGM.wrong();
    showEffect('‚úó YANLI≈û!','wrong-color');
    setGameStatus('Yanlƒ±≈ü cevap! Oyun bitti.','error');
    await TTS.sayWrong(q.a[correct]);
    await delay(800);
    const keepPrize=G.barrierPassed>=0?PRIZE_TABLE[G.barrierPassed]:0;
    await endGame(false, keepPrize);
  }
}

async function submitDoubleAnswer() {
  G.inputLocked=true; clearTimer();
  const q=G.questions[G.current];
  const correct=q.correct;
  if (G.doubleSelected.includes(correct)) {
    // Correct! But no prize multiplier
    BGM.correct();
    const xp=Math.floor(XP_TABLE[G.current]*0.5*(G.xpBoostActive?2:1)); // Half XP for double
    const coin=Math.floor(COIN_TABLE[G.current]*0.5);
    G.xpEarned+=xp; G.coinEarned+=coin; G.prizeTotal=PRIZE_TABLE[G.current]; G.answers++;
    if (BARRIERS.includes(G.current)) G.barrierPassed=G.current;
    document.getElementById('g-xp').textContent=`+${G.xpEarned}`;
    renderAnswers(q.a, correct, -1);
    showEffect(`‚úì +${xp} XP`,'correct-color');
    await TTS.sayCorrect();
    G.current++;
    await delay(600);
    await loadQuestion();
  } else {
    BGM.wrong();
    renderAnswers(q.a, correct, G.doubleSelected[0]);
    showEffect('‚úó YANLI≈û!','wrong-color');
    setGameStatus('Yanlƒ±≈ü cevap! Oyun bitti.','error');
    await TTS.sayWrong(q.a[correct]);
    await delay(800);
    const keepPrize=G.barrierPassed>=0?PRIZE_TABLE[G.barrierPassed]:0;
    await endGame(false, keepPrize);
  }
}

function setGameStatus(msg,type='') {
  const el=document.getElementById('game-status');
  el.textContent=msg;
  el.style.color=type==='error'?'var(--red)':type==='success'?'var(--green)':'var(--text2)';
}

function startTimer(sec) {
  clearTimer(); G.timerSec=sec; G.timerMax=sec; updateTimerUI();
  G.timerInterval=setInterval(async()=>{
    G.timerSec--; updateTimerUI();
    if(G.timerSec<=0){
      clearTimer(); G.inputLocked=true;
      setGameStatus('S√ºre doldu!','error');
      await delay(500);
      const keepPrize=G.barrierPassed>=0?PRIZE_TABLE[G.barrierPassed]:0;
      await endGame(false,keepPrize);
    }
  },1000);
}
function clearTimer() { if(G.timerInterval){clearInterval(G.timerInterval);G.timerInterval=null;} }
function updateTimerUI() {
  const pct=(G.timerSec/G.timerMax*100).toFixed(1);
  const circle=document.getElementById('timer-circle');
  circle.style.setProperty('--pct',pct+'%');
  document.getElementById('timer-num').textContent=G.timerSec;
  circle.classList.toggle('danger',G.timerSec<=5);
}

function renderBarriers() {
  const bar=document.getElementById('barriers-bar');
  const marks=[4,9,14];
  bar.innerHTML=marks.map(i=>{
    let cls='future';
    if(G.current>i)cls='passed';
    else if(G.current===i+1||(i===14&&G.current===14))cls='current';
    const label=i===4?'üõ°Ô∏è G√ºvenli':i===9?'üõ°Ô∏è G√ºvenli':'üèÜ Final';
    return `<div class="barrier-item ${cls}">${label} Q${i+1}</div>`;
  }).join('');
}

function resetJokerButtons() {
  ['fifty','audience','phone'].forEach(j=>{ const btn=document.getElementById('j-'+j); btn.classList.remove('used'); btn.disabled=false; });
  // Double joker
  const doubleBtn = document.getElementById('j-double');
  const u = window._userData;
  if (u && (u.doubleJokerCount||0) > 0) {
    doubleBtn.style.display='flex';
    doubleBtn.classList.remove('used');
    doubleBtn.disabled=false;
    doubleBtn.title=`${u.doubleJokerCount}x joker`;
  } else {
    doubleBtn.style.display='none';
  }
}

function updateJokerBtns() {
  ['fifty','audience','phone'].forEach(j=>{ const btn=document.getElementById('j-'+j); if(G.jokers[j]){btn.classList.add('used');btn.disabled=true;} });
  const doubleBtn = document.getElementById('j-double');
  if (G.jokers.double) { doubleBtn.classList.add('used'); doubleBtn.disabled=true; }
}

async function useJoker(type) {
  if(G.jokers[type]||G.inputLocked)return;

  if (type === 'double') {
    G.jokers.double=true; updateJokerBtns();
    G.doubleMode=true; G.doubleSelected=[];
    // Consume joker from DB
    const newCount = Math.max(0, (window._userData?.doubleJokerCount||0) - 1);
    await window._saveUserData({ doubleJokerCount: newCount });
    setGameStatus('‚úåÔ∏è ƒ∞ki ≈üƒ±k se√ß! Her ikisi de g√∂sterilecek.', '');
    toast('√áift Cevap Jokeri aktif! 2 ≈üƒ±k se√ßin.', 'gold');
    await TTS.speak('√áift cevap jokeri kullanƒ±ldƒ±. ƒ∞ki ≈üƒ±k se√ßin.', 0.95, 1.0);
    return;
  }

  G.jokers[type]=true; updateJokerBtns();
  const q=G.questions[G.current];
  if(type==='fifty'){
    const wrongIndices=q.a.map((_,i)=>i).filter(i=>i!==q.correct);
    const toRemove=shuffle(wrongIndices).slice(0,2);
    document.querySelectorAll('.answer-btn').forEach((btn,i)=>{ if(toRemove.includes(i))btn.classList.add('hidden-joker'); });
    toast('%50 jokeri kullanƒ±ldƒ±!','info');
    await TTS.speak('Elli y√ºzde jokeri kullanƒ±ldƒ±. ƒ∞ki ≈üƒ±k elendi.',0.95,1.0);
  } else if(type==='audience'){
    const votes=q.a.map((_,i)=>i===q.correct?55+Math.floor(Math.random()*25):Math.floor(Math.random()*20));
    const total=votes.reduce((a,b)=>a+b,0);
    const pcts=votes.map(v=>Math.round(v/total*100));
    const letters=['A','B','C','D'];
    document.getElementById('audience-result').innerHTML=`<div class="audience-chart">${pcts.map((p,i)=>`<div class="aud-bar-wrap"><div class="aud-pct">${p}%</div><div class="aud-bar-bg"><div class="aud-bar-fill" style="height:${p}%"></div></div><div class="aud-label">${letters[i]}</div></div>`).join('')}</div>`;
    toast('Seyirci jokeri kullanƒ±ldƒ±!','info');
    await TTS.speak(`Seyirci oyu kullanƒ±ldƒ±. En y√ºksek oy: ${letters[pcts.indexOf(Math.max(...pcts))]} ≈üƒ±kkƒ±, y√ºzde ${Math.max(...pcts)}.`,0.9,1.0);
  } else if(type==='phone'){
    const correct=q.a[q.correct];
    const confidence=60+Math.floor(Math.random()*30);
    const phoneTexts=[
      `Hmm, bu soruyu hatƒ±rlƒ±yorum... Sanƒ±rƒ±m cevap "${correct}" olmalƒ±. %${confidence} eminimim.`,
      `Arkada≈üƒ±m, bence cevap "${correct}". Ama %${confidence} emin olabiliyorum, karar senin.`,
    ];
    const txt=phoneTexts[Math.floor(Math.random()*phoneTexts.length)];
    document.getElementById('phone-result').innerHTML=`<div class="phone-msg">üìû "${txt}"</div>`;
    toast('Telefon jokeri kullanƒ±ldƒ±!','info');
    await TTS.speak(txt,0.9,1.05);
  }
}

async function endGame(won, keepPrize=null) {
  clearTimer(); TTS.stop(); BGM.stop(); G.inputLocked=true;
  const finalPrize=won?G.prizeTotal:(keepPrize!==null?keepPrize:0);
  const xp=G.xpEarned;
  const coin=G.coinEarned+Math.floor(finalPrize/1000);
  const u=window._userData;
  if (u) {
    const newXp=(u.xp||0)+xp;
    const newCoins=(u.coins||0)+coin;
    const newGames=(u.games||0)+1;
    const newWins=won?(u.wins||0)+1:(u.wins||0);
    const newLosses=!won?(u.losses||0)+1:(u.losses||0);
    await window._saveUserData({ xp:newXp, coins:newCoins, games:newGames, wins:newWins, losses:newLosses });
  }
  const modal=document.getElementById('modal-gameover-inner');
  modal.className='modal '+(won?'win':'lose');
  document.getElementById('go-icon').textContent=won?'üèÜ':'üíÄ';
  document.getElementById('go-title').textContent=won?'TEBRƒ∞KLER!':'MAƒûLUBƒ∞YET';
  document.getElementById('go-sub').textContent=won?'T√ºm sorularƒ± bildiniz!':G.barrierPassed>=0?'G√ºvenli baraja kadar geldiniz!':'Bir dahaki sefere...';
  document.getElementById('go-qright').textContent=G.answers;
  document.getElementById('go-prize').textContent=finalPrize.toLocaleString()+' ‚Ç∫';
  document.getElementById('go-reward').textContent=`‚≠ê +${xp} XP  ¬∑  üí∞ +${coin} Coin`;
  openModal('modal-gameover');
  updateLobbyUI();
}

async function withdrawGame() {
  if (G.inputLocked) return;
  if (G.current === 0) return toast('Hen√ºz hi√ß soru cevaplanmadƒ±!', 'info');
  const currentPrize = G.current > 0 ? PRIZE_TABLE[G.current - 1] : 0;
  if (currentPrize === 0) return toast('Hen√ºz kazanƒ±lan para yok!', 'info');

  const confirmed = await showConfirmDialog(`${currentPrize.toLocaleString()} ‚Ç∫ ile √ßekilmek istiyor musunuz?`);
  if (!confirmed) return;

  clearTimer(); TTS.stop(); BGM.stop(); G.inputLocked = true;
  showEffect('üí∞ √áEKƒ∞LDƒ∞!', 'correct-color');
  setGameStatus('Tebrikler! Kazancƒ±nƒ±zla √ßekildiniz.', 'success');
  const xp = G.xpEarned;
  const coin = G.coinEarned + Math.floor(currentPrize / 1000);
  const u = window._userData;
  if (u) {
    await window._saveUserData({
      xp: (u.xp||0) + xp, coins: (u.coins||0) + coin,
      games: (u.games||0) + 1, wins: (u.wins||0) + 1
    });
  }
  await delay(800);
  await TTS.speak(`Tebrikler! ${currentPrize.toLocaleString()} lira ile √ßekildiniz.`, 1.0, 1.0);
  const modal = document.getElementById('modal-gameover-inner');
  modal.className = 'modal win';
  document.getElementById('go-icon').textContent = 'üí∞';
  document.getElementById('go-title').textContent = '√áEKƒ∞LDƒ∞Nƒ∞Z!';
  document.getElementById('go-sub').textContent = 'Kazancƒ±nƒ±zla ayrƒ±ldƒ±nƒ±z!';
  document.getElementById('go-qright').textContent = G.answers;
  document.getElementById('go-prize').textContent = currentPrize.toLocaleString() + ' ‚Ç∫';
  document.getElementById('go-reward').textContent = `‚≠ê +${xp} XP  ¬∑  üí∞ +${coin} Coin`;
  openModal('modal-gameover');
  updateLobbyUI();
}

// Custom confirm dialog (replacing browser confirm)
function showConfirmDialog(msg) {
  return new Promise(resolve => {
    const overlay = document.createElement('div');
    overlay.style.cssText='position:fixed;inset:0;background:rgba(0,0,0,0.85);backdrop-filter:blur(12px);z-index:9000;display:flex;align-items:center;justify-content:center;padding:16px;';
    overlay.innerHTML=`<div style="background:var(--bg2);border:1px solid var(--border);border-radius:20px;padding:28px;max-width:340px;width:100%;text-align:center;animation:modalPop 0.3s cubic-bezier(0.22,1,0.36,1);">
      <div style="font-size:1.4rem;margin-bottom:12px">üí∞</div>
      <div style="font-family:'Cinzel',serif;font-weight:700;font-size:1rem;margin-bottom:8px">√áEKILME ONAYI</div>
      <div style="color:var(--text2);font-size:0.88rem;margin-bottom:20px">${msg}</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <button id="confirm-no" style="padding:12px;background:var(--glass);border:1px solid var(--border);border-radius:12px;color:var(--text);font-family:'Exo 2',sans-serif;font-weight:700;cursor:pointer;">ƒ∞PTAL</button>
        <button id="confirm-yes" style="padding:12px;background:linear-gradient(135deg,var(--gold2),var(--gold));border:none;border-radius:12px;color:#000;font-family:'Cinzel',serif;font-weight:700;cursor:pointer;">√áEKƒ∞L</button>
      </div>
    </div>`;
    document.body.appendChild(overlay);
    overlay.querySelector('#confirm-yes').onclick = () => { overlay.remove(); resolve(true); };
    overlay.querySelector('#confirm-no').onclick = () => { overlay.remove(); resolve(false); };
  });
}

async function exitGame() {
  const confirmed = await showConfirmDialog('Oyundan √ßƒ±kmak istiyor musunuz? ƒ∞lerlemeniz kaydedilmeyecek.');
  if (!confirmed) return;
  clearTimer(); TTS.stop(); BGM.stop(); G.inputLocked=true;
  goLobby();
}

function goLobby() {
  closeModal('modal-gameover');
  clearTimer(); TTS.stop(); BGM.stop();
  if(_lbUnsub){_lbUnsub();_lbUnsub=null;}
  showScreen('lobby');
  updateLobbyUI();
}

// ‚îÄ‚îÄ‚îÄ Voice Settings ‚îÄ‚îÄ‚îÄ
function openVoiceSettings() {
  TTS.allVoices=speechSynthesis.getVoices();
  const voices=TTS.allVoices;
  const trVoices=voices.filter(v=>v.lang.startsWith('tr'));
  const otherVoices=voices.filter(v=>!v.lang.startsWith('tr'));
  const currentName=TTS.selectedVoice?TTS.selectedVoice.name:'';
  let html=`<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
    <div style="font-size:0.8rem;color:var(--text2)">Ses Aktif:</div>
    <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
      <input type="checkbox" id="tts-toggle" ${TTS.enabled?'checked':''} onchange="toggleTTS(this.checked)" style="accent-color:var(--blue);width:16px;height:16px">
      <span style="font-size:0.85rem">${TTS.enabled?'A√ßƒ±k':'Kapalƒ±'}</span>
    </label>
  </div>
  <div style="margin-bottom:8px;font-size:0.75rem;color:var(--text2);letter-spacing:2px">SES HIZI</div>
  <input type="range" id="tts-rate" min="0.5" max="1.8" step="0.1" value="${localStorage.getItem('qz_tts_rate')||0.9}"
    oninput="document.getElementById('tts-rate-val').textContent=this.value"
    style="width:100%;accent-color:var(--blue);margin-bottom:4px">
  <div style="display:flex;justify-content:space-between;font-size:0.75rem;color:var(--text2);margin-bottom:16px">
    <span>Yava≈ü</span><span id="tts-rate-val">${localStorage.getItem('qz_tts_rate')||0.9}</span><span>Hƒ±zlƒ±</span>
  </div>`;
  if(trVoices.length>0){html+=`<div style="margin-bottom:8px;font-size:0.75rem;color:var(--green);letter-spacing:2px">üáπüá∑ T√úRK√áE SESLER (${trVoices.length})</div>`;html+=trVoices.map(v=>voiceCard(v,currentName)).join('');}
  if(otherVoices.length>0){html+=`<div style="margin:14px 0 8px;font-size:0.75rem;color:var(--text2);letter-spacing:2px">üåç Dƒ∞ƒûER SESLER (${otherVoices.length})</div>`;html+=otherVoices.map(v=>voiceCard(v,currentName)).join('');}
  if(voices.length===0)html+=`<div style="text-align:center;color:var(--text2);padding:20px">Ses bulunamadƒ±.</div>`;
  document.getElementById('voice-list').innerHTML=html;
  openModal('modal-voice');
}

function voiceCard(v,currentName){
  const isSel=v.name===currentName;
  const isLocal=v.localService?'üíæ Yerel':'‚òÅÔ∏è √áevrimi√ßi';
  return `<div class="voice-card ${isSel?'selected':''}" onclick="selectVoice('${v.name.replace(/'/g,"\\'")}',this)">
    <div style="display:flex;align-items:center;justify-content:space-between">
      <div><div style="font-weight:700;font-size:0.88rem;color:${isSel?'var(--blue)':'var(--text)'}">${v.name}</div><div style="font-size:0.72rem;color:var(--text2);margin-top:2px">${v.lang} ¬∑ ${isLocal}</div></div>
      <div style="display:flex;gap:8px;align-items:center">
        ${isSel?'<div style="color:var(--green);font-size:0.8rem">‚úì SE√áƒ∞Lƒ∞</div>':''}
        <button onclick="event.stopPropagation();testVoice('${v.name.replace(/'/g,"\\'")}',${JSON.stringify(v.name)})" style="padding:5px 10px;background:rgba(0,195,255,0.1);border:1px solid rgba(0,195,255,0.2);border-radius:8px;color:var(--blue);font-size:0.72rem;cursor:pointer;white-space:nowrap">‚ñ∂ Test</button>
      </div>
    </div>
  </div>`;
}

function selectVoice(name,el){
  TTS.setVoice(name);
  document.querySelectorAll('.voice-card').forEach(c=>c.classList.remove('selected'));
  if(el)el.classList.add('selected');
  toast('‚úì Ses se√ßildi: '+name,'success');
  setTimeout(()=>openVoiceSettings(),100);
}

function testVoice(name){
  const v=TTS.allVoices.find(v=>v.name===name);
  if(!v)return;
  speechSynthesis.cancel();
  const u=new SpeechSynthesisUtterance('Merhaba! Bu ses testi. Quizora\'ya ho≈ü geldiniz.');
  u.voice=v;u.lang=v.lang;u.rate=parseFloat(document.getElementById('tts-rate')?.value||0.9);u.pitch=1.0;
  speechSynthesis.speak(u);
}

function toggleTTS(val){
  TTS.enabled=val;
  localStorage.setItem('qz_tts_enabled',val);
  const label=document.querySelector('#tts-toggle + span');
  if(label)label.textContent=val?'A√ßƒ±k':'Kapalƒ±';
}

function saveVoiceSettings(){
  const rate=document.getElementById('tts-rate')?.value;
  if(rate)localStorage.setItem('qz_tts_rate',parseFloat(rate));
  speechSynthesis.cancel();
  closeModal('modal-voice');
  toast('Ses ayarlarƒ± kaydedildi!','success');
}

// ‚îÄ‚îÄ‚îÄ Keyboard shortcuts ‚îÄ‚îÄ‚îÄ
document.addEventListener('keydown', e=>{
  if(e.key==='Enter'){
    if(!document.getElementById('auth-screen').classList.contains('hidden')){
      if(authMode==='login')doLogin();else doRegister();
    }
  }
  if(!document.getElementById('game-screen').classList.contains('hidden')&&!G.inputLocked){
    const map={'1':0,'2':1,'3':2,'4':3,'a':0,'b':1,'c':2,'d':3};
    if(map[e.key.toLowerCase()]!==undefined)pickAnswer(map[e.key.toLowerCase()]);
  }
});
</script>
</body>
</html>
